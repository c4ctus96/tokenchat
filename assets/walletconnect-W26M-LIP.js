import{s as Rt,a as Qt,e as pt,c as N,I as Cr,b as Rr,w as gs,r as ps,f as wi,t as ei,d as Lr,i as Li,g as Dr,h as Nr,j as ys,p as Kr,k as Ft,l as ms,m as Ur,n as $r,P as li,G as jr,Y as Hr,E as Je,y as et,x as j,o as Br,q as bs,A as kr,u as Fr,v as fi,z as qr,B as Gr,C as Wr,D as Di,F as Jr,M as Vr,H as Yr,X as Ni,J as Xr,K as Zr,L as Qr,N as ws,O as ui,Q as en,W as tn,R as It,S as Ki,T as sn,$ as rn,U as vs,V as xs,Z as _s,_ as nn,a0 as an,a1 as on,a2 as Jt,a3 as cn,a4 as Ui,a5 as hn,a6 as si,a7 as Mt,a8 as $i,a9 as ln,aa as Is,ab as ri,ac as fn,ad as un,ae as dn,af as gn,ag as Es,ah as pn,ai as yn,aj as mn,ak as bn,al as wn,am as vn,an as xn,ao as Ss,ap as Ps,aq as _n,ar as di,as as In,at as gi,au as zt,av as En,aw as Sn}from"./vendor-BMh1wcQf.js";const Pn=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Tn=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,An=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function On(n,e){if(n==="__proto__"||n==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Mn(n);return}return e}function Mn(n){console.warn(`[destr] Dropping "${n}" key to prevent prototype pollution.`)}function qt(n,e={}){if(typeof n!="string")return n;const t=n.trim();if(n[0]==='"'&&n.endsWith('"')&&!n.includes("\\"))return t.slice(1,-1);if(t.length<=9){const r=t.toLowerCase();if(r==="true")return!0;if(r==="false")return!1;if(r==="undefined")return;if(r==="null")return null;if(r==="nan")return Number.NaN;if(r==="infinity")return Number.POSITIVE_INFINITY;if(r==="-infinity")return Number.NEGATIVE_INFINITY}if(!An.test(n)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return n}try{if(Pn.test(n)||Tn.test(n)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(n,On)}return JSON.parse(n)}catch(r){if(e.strict)throw r;return n}}function zn(n){return!n||typeof n.then!="function"?Promise.resolve(n):n}function ze(n,...e){try{return zn(n(...e))}catch(t){return Promise.reject(t)}}function Cn(n){const e=typeof n;return n===null||e!=="object"&&e!=="function"}function Rn(n){const e=Object.getPrototypeOf(n);return!e||e.isPrototypeOf(Object)}function Vt(n){if(Cn(n))return String(n);if(Rn(n)||Array.isArray(n))return JSON.stringify(n);if(typeof n.toJSON=="function")return Vt(n.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Ts(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const pi="base64:";function Ln(n){if(typeof n=="string")return n;Ts();const e=Buffer.from(n).toString("base64");return pi+e}function Dn(n){return typeof n!="string"||!n.startsWith(pi)?n:(Ts(),Buffer.from(n.slice(pi.length),"base64"))}function Be(n){return n?n.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Nn(...n){return Be(n.join(":"))}function Gt(n){return n=Be(n),n?n+":":""}const Kn="memory",Un=()=>{const n=new Map;return{name:Kn,options:{},hasItem(e){return n.has(e)},getItem(e){return n.get(e)??null},getItemRaw(e){return n.get(e)??null},setItem(e,t){n.set(e,t)},setItemRaw(e,t){n.set(e,t)},removeItem(e){n.delete(e)},getKeys(){return Array.from(n.keys())},clear(){n.clear()},dispose(){n.clear()}}};function $n(n={}){const e={mounts:{"":n.driver||Un()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},t=l=>{for(const g of e.mountpoints)if(l.startsWith(g))return{base:g,relativeKey:l.slice(g.length),driver:e.mounts[g]};return{base:"",relativeKey:l,driver:e.mounts[""]}},r=(l,g)=>e.mountpoints.filter(w=>w.startsWith(l)||g&&l.startsWith(w)).map(w=>({relativeBase:l.length>w.length?l.slice(w.length):void 0,mountpoint:w,driver:e.mounts[w]})),s=(l,g)=>{if(e.watching){g=Be(g);for(const w of e.watchListeners)w(l,g)}},o=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await ji(e.mounts[l],s,l)}},c=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},u=(l,g,w)=>{const I=new Map,O=_=>{let C=I.get(_.base);return C||(C={driver:_.driver,base:_.base,items:[]},I.set(_.base,C)),C};for(const _ of l){const C=typeof _=="string",$=Be(C?_:_.key),K=C?void 0:_.value,D=C||!_.options?g:{...g,..._.options},V=t($);O(V).items.push({key:$,value:K,relativeKey:V.relativeKey,options:D})}return Promise.all([...I.values()].map(_=>w(_))).then(_=>_.flat())},m={hasItem(l,g={}){l=Be(l);const{relativeKey:w,driver:I}=t(l);return ze(I.hasItem,w,g)},getItem(l,g={}){l=Be(l);const{relativeKey:w,driver:I}=t(l);return ze(I.getItem,w,g).then(O=>qt(O))},getItems(l,g){return u(l,g,w=>w.driver.getItems?ze(w.driver.getItems,w.items.map(I=>({key:I.relativeKey,options:I.options})),g).then(I=>I.map(O=>({key:Nn(w.base,O.key),value:qt(O.value)}))):Promise.all(w.items.map(I=>ze(w.driver.getItem,I.relativeKey,I.options).then(O=>({key:I.key,value:qt(O)})))))},getItemRaw(l,g={}){l=Be(l);const{relativeKey:w,driver:I}=t(l);return I.getItemRaw?ze(I.getItemRaw,w,g):ze(I.getItem,w,g).then(O=>Dn(O))},async setItem(l,g,w={}){if(g===void 0)return m.removeItem(l);l=Be(l);const{relativeKey:I,driver:O}=t(l);O.setItem&&(await ze(O.setItem,I,Vt(g),w),O.watch||s("update",l))},async setItems(l,g){await u(l,g,async w=>{if(w.driver.setItems)return ze(w.driver.setItems,w.items.map(I=>({key:I.relativeKey,value:Vt(I.value),options:I.options})),g);w.driver.setItem&&await Promise.all(w.items.map(I=>ze(w.driver.setItem,I.relativeKey,Vt(I.value),I.options)))})},async setItemRaw(l,g,w={}){if(g===void 0)return m.removeItem(l,w);l=Be(l);const{relativeKey:I,driver:O}=t(l);if(O.setItemRaw)await ze(O.setItemRaw,I,g,w);else if(O.setItem)await ze(O.setItem,I,Ln(g),w);else return;O.watch||s("update",l)},async removeItem(l,g={}){typeof g=="boolean"&&(g={removeMeta:g}),l=Be(l);const{relativeKey:w,driver:I}=t(l);I.removeItem&&(await ze(I.removeItem,w,g),(g.removeMeta||g.removeMata)&&await ze(I.removeItem,w+"$",g),I.watch||s("remove",l))},async getMeta(l,g={}){typeof g=="boolean"&&(g={nativeOnly:g}),l=Be(l);const{relativeKey:w,driver:I}=t(l),O=Object.create(null);if(I.getMeta&&Object.assign(O,await ze(I.getMeta,w,g)),!g.nativeOnly){const _=await ze(I.getItem,w+"$",g).then(C=>qt(C));_&&typeof _=="object"&&(typeof _.atime=="string"&&(_.atime=new Date(_.atime)),typeof _.mtime=="string"&&(_.mtime=new Date(_.mtime)),Object.assign(O,_))}return O},setMeta(l,g,w={}){return this.setItem(l+"$",g,w)},removeMeta(l,g={}){return this.removeItem(l+"$",g)},async getKeys(l,g={}){l=Gt(l);const w=r(l,!0);let I=[];const O=[];for(const _ of w){const $=(await ze(_.driver.getKeys,_.relativeBase,g)).map(K=>_.mountpoint+Be(K)).filter(K=>!I.some(D=>K.startsWith(D)));O.push(...$),I=[_.mountpoint,...I.filter(K=>!K.startsWith(_.mountpoint))]}return l?O.filter(_=>_.startsWith(l)&&!_.endsWith("$")):O.filter(_=>!_.endsWith("$"))},async clear(l,g={}){l=Gt(l),await Promise.all(r(l,!1).map(async w=>{if(w.driver.clear)return ze(w.driver.clear,w.relativeBase,g);if(w.driver.removeItem){const I=await w.driver.getKeys(w.relativeBase||"",g);return Promise.all(I.map(O=>w.driver.removeItem(O,g)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>Hi(l)))},async watch(l){return await o(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(g=>g!==l),e.watchListeners.length===0&&await c()}},async unwatch(){e.watchListeners=[],await c()},mount(l,g){if(l=Gt(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((w,I)=>I.length-w.length)),e.mounts[l]=g,e.watching&&Promise.resolve(ji(g,s,l)).then(w=>{e.unwatch[l]=w}).catch(console.error),m},async unmount(l,g=!0){l=Gt(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l](),delete e.unwatch[l]),g&&await Hi(e.mounts[l]),e.mountpoints=e.mountpoints.filter(w=>w!==l),delete e.mounts[l])},getMount(l=""){l=Be(l)+":";const g=t(l);return{driver:g.driver,base:g.base}},getMounts(l="",g={}){return l=Be(l),r(l,g.parents).map(I=>({driver:I.driver,base:I.mountpoint}))}};return m}function ji(n,e,t){return n.watch?n.watch((r,s)=>e(r,t+s)):()=>{}}async function Hi(n){typeof n.dispose=="function"&&await ze(n.dispose)}function vt(n){return new Promise((e,t)=>{n.oncomplete=n.onsuccess=()=>e(n.result),n.onabort=n.onerror=()=>t(n.error)})}function As(n,e){const t=indexedDB.open(n);t.onupgradeneeded=()=>t.result.createObjectStore(e);const r=vt(t);return(s,o)=>r.then(c=>o(c.transaction(e,s).objectStore(e)))}let ni;function Lt(){return ni||(ni=As("keyval-store","keyval")),ni}function Bi(n,e=Lt()){return e("readonly",t=>vt(t.get(n)))}function jn(n,e,t=Lt()){return t("readwrite",r=>(r.put(e,n),vt(r.transaction)))}function Hn(n,e=Lt()){return e("readwrite",t=>(t.delete(n),vt(t.transaction)))}function Bn(n=Lt()){return n("readwrite",e=>(e.clear(),vt(e.transaction)))}function kn(n,e){return n.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},vt(n.transaction)}function Fn(n=Lt()){return n("readonly",e=>{if(e.getAllKeys)return vt(e.getAllKeys());const t=[];return kn(e,r=>t.push(r.key)).then(()=>t)})}const qn="idb-keyval";var Gn=(n={})=>{const e=n.base&&n.base.length>0?`${n.base}:`:"",t=s=>e+s;let r;return n.dbName&&n.storeName&&(r=As(n.dbName,n.storeName)),{name:qn,options:n,async hasItem(s){return!(typeof await Bi(t(s),r)>"u")},async getItem(s){return await Bi(t(s),r)??null},setItem(s,o){return jn(t(s),o,r)},removeItem(s){return Hn(t(s),r)},getKeys(){return Fn(r)},clear(){return Bn(r)}}};const Wn="WALLET_CONNECT_V2_INDEXED_DB",Jn="keyvaluestorage";class Vn{constructor(){this.indexedDb=$n({driver:Gn({dbName:Wn,storeName:Jn})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const t=await this.indexedDb.getItem(e);if(t!==null)return t}async setItem(e,t){await this.indexedDb.setItem(e,Rt(t))}async removeItem(e){await this.indexedDb.removeItem(e)}}var ai=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Yt={exports:{}};(function(){let n;function e(){}n=e,n.prototype.getItem=function(t){return this.hasOwnProperty(t)?String(this[t]):null},n.prototype.setItem=function(t,r){this[t]=String(r)},n.prototype.removeItem=function(t){delete this[t]},n.prototype.clear=function(){const t=this;Object.keys(t).forEach(function(r){t[r]=void 0,delete t[r]})},n.prototype.key=function(t){return t=t||0,Object.keys(this)[t]},n.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ai<"u"&&ai.localStorage?Yt.exports=ai.localStorage:typeof window<"u"&&window.localStorage?Yt.exports=window.localStorage:Yt.exports=new e})();function Yn(n){var e;return[n[0],Qt((e=n[1])!=null?e:"")]}class Xn{constructor(){this.localStorage=Yt.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(Yn)}async getItem(e){const t=this.localStorage.getItem(e);if(t!==null)return Qt(t)}async setItem(e,t){this.localStorage.setItem(e,Rt(t))}async removeItem(e){this.localStorage.removeItem(e)}}const Zn="wc_storage_version",ki=1,Qn=async(n,e,t)=>{const r=Zn,s=await e.getItem(r);if(s&&s>=ki){t(e);return}const o=await n.getKeys();if(!o.length){t(e);return}const c=[];for(;o.length;){const u=o.shift();if(!u)continue;const m=u.toLowerCase();if(m.includes("wc@")||m.includes("walletconnect")||m.includes("wc_")||m.includes("wallet_connect")){const l=await n.getItem(u);await e.setItem(u,l),c.push(u)}}await e.setItem(r,ki),t(e),ea(n,c)},ea=async(n,e)=>{e.length&&e.forEach(async t=>{await n.removeItem(t)})};let ta=class{constructor(){this.initialized=!1,this.setInitialized=t=>{this.storage=t,this.initialized=!0};const e=new Xn;this.storage=e;try{const t=new Vn;Qn(e,t,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,t){return await this.initialize(),this.storage.setItem(e,t)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const t=setInterval(()=>{this.initialized&&(clearInterval(t),e())},20)})}};class ia extends Cr{constructor(e){super()}}const Fi=N.FIVE_SECONDS,Dt={pulse:"heartbeat_pulse"};class vi extends ia{constructor(e){super(e),this.events=new pt.EventEmitter,this.interval=Fi,this.interval=(e==null?void 0:e.interval)||Fi}static async init(e){const t=new vi(e);return await t.init(),t}async init(){await this.initialize()}stop(){clearInterval(this.intervalRef)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async initialize(){this.intervalRef=setInterval(()=>this.pulse(),N.toMiliseconds(this.interval))}pulse(){this.events.emit(Dt.pulse)}}var xi={},Os={};(function(n){Object.defineProperty(n,"__esModule",{value:!0});var e=Rr,t=gs;n.DIGEST_LENGTH=64,n.BLOCK_SIZE=128;var r=function(){function u(){this.digestLength=n.DIGEST_LENGTH,this.blockSize=n.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){t.wipe(this._buffer),t.wipe(this._tempHi),t.wipe(this._tempLo),this.reset()},u.prototype.update=function(m,l){if(l===void 0&&(l=m.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var g=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<n.BLOCK_SIZE&&l>0;)this._buffer[this._bufferLength++]=m[g++],l--;this._bufferLength===this.blockSize&&(o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(g=o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,m,g,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=m[g++],l--;return this},u.prototype.finish=function(m){if(!this._finished){var l=this._bytesHashed,g=this._bufferLength,w=l/536870912|0,I=l<<3,O=l%128<112?128:256;this._buffer[g]=128;for(var _=g+1;_<O-8;_++)this._buffer[_]=0;e.writeUint32BE(w,this._buffer,O-8),e.writeUint32BE(I,this._buffer,O-4),o(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,O),this._finished=!0}for(var _=0;_<this.digestLength/8;_++)e.writeUint32BE(this._stateHi[_],m,_*8),e.writeUint32BE(this._stateLo[_],m,_*8+4);return this},u.prototype.digest=function(){var m=new Uint8Array(this.digestLength);return this.finish(m),m},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(m){return this._stateHi.set(m.stateHi),this._stateLo.set(m.stateLo),this._bufferLength=m.bufferLength,m.buffer&&this._buffer.set(m.buffer),this._bytesHashed=m.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(m){t.wipe(m.stateHi),t.wipe(m.stateLo),m.buffer&&t.wipe(m.buffer),m.bufferLength=0,m.bytesHashed=0},u}();n.SHA512=r;var s=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function o(u,m,l,g,w,I,O){for(var _=l[0],C=l[1],$=l[2],K=l[3],D=l[4],V=l[5],te=l[6],F=l[7],U=g[0],z=g[1],q=g[2],je=g[3],ve=g[4],Ve=g[5],ke=g[6],tt=g[7],x,v,ie,ye,A,E,S,T;O>=128;){for(var Ce=0;Ce<16;Ce++){var ce=8*Ce+I;u[Ce]=e.readUint32BE(w,ce),m[Ce]=e.readUint32BE(w,ce+4)}for(var Ce=0;Ce<80;Ce++){var Et=_,H=C,xt=$,y=K,p=D,d=V,i=te,h=F,M=U,R=z,k=q,G=je,B=ve,W=Ve,Re=ke,me=tt;if(x=F,v=tt,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=(D>>>14|ve<<18)^(D>>>18|ve<<14)^(ve>>>9|D<<23),v=(ve>>>14|D<<18)^(ve>>>18|D<<14)^(D>>>9|ve<<23),A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,x=D&V^~D&te,v=ve&Ve^~ve&ke,A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,x=s[Ce*2],v=s[Ce*2+1],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,x=u[Ce%16],v=m[Ce%16],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,ie=S&65535|T<<16,ye=A&65535|E<<16,x=ie,v=ye,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=(_>>>28|U<<4)^(U>>>2|_<<30)^(U>>>7|_<<25),v=(U>>>28|_<<4)^(_>>>2|U<<30)^(_>>>7|U<<25),A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,x=_&C^_&$^C&$,v=U&z^U&q^z&q,A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,h=S&65535|T<<16,me=A&65535|E<<16,x=y,v=G,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=ie,v=ye,A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,y=S&65535|T<<16,G=A&65535|E<<16,C=Et,$=H,K=xt,D=y,V=p,te=d,F=i,_=h,z=M,q=R,je=k,ve=G,Ve=B,ke=W,tt=Re,U=me,Ce%16===15)for(var ce=0;ce<16;ce++)x=u[ce],v=m[ce],A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=u[(ce+9)%16],v=m[(ce+9)%16],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,ie=u[(ce+1)%16],ye=m[(ce+1)%16],x=(ie>>>1|ye<<31)^(ie>>>8|ye<<24)^ie>>>7,v=(ye>>>1|ie<<31)^(ye>>>8|ie<<24)^(ye>>>7|ie<<25),A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,ie=u[(ce+14)%16],ye=m[(ce+14)%16],x=(ie>>>19|ye<<13)^(ye>>>29|ie<<3)^ie>>>6,v=(ye>>>19|ie<<13)^(ie>>>29|ye<<3)^(ye>>>6|ie<<26),A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,u[ce]=S&65535|T<<16,m[ce]=A&65535|E<<16}x=_,v=U,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[0],v=g[0],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[0]=_=S&65535|T<<16,g[0]=U=A&65535|E<<16,x=C,v=z,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[1],v=g[1],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[1]=C=S&65535|T<<16,g[1]=z=A&65535|E<<16,x=$,v=q,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[2],v=g[2],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[2]=$=S&65535|T<<16,g[2]=q=A&65535|E<<16,x=K,v=je,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[3],v=g[3],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[3]=K=S&65535|T<<16,g[3]=je=A&65535|E<<16,x=D,v=ve,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[4],v=g[4],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[4]=D=S&65535|T<<16,g[4]=ve=A&65535|E<<16,x=V,v=Ve,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[5],v=g[5],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[5]=V=S&65535|T<<16,g[5]=Ve=A&65535|E<<16,x=te,v=ke,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[6],v=g[6],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[6]=te=S&65535|T<<16,g[6]=ke=A&65535|E<<16,x=F,v=tt,A=v&65535,E=v>>>16,S=x&65535,T=x>>>16,x=l[7],v=g[7],A+=v&65535,E+=v>>>16,S+=x&65535,T+=x>>>16,E+=A>>>16,S+=E>>>16,T+=S>>>16,l[7]=F=S&65535|T<<16,g[7]=tt=A&65535|E<<16,I+=128,O-=128}return I}function c(u){var m=new r;m.update(u);var l=m.digest();return m.clean(),l}n.hash=c})(Os);(function(n){Object.defineProperty(n,"__esModule",{value:!0}),n.convertSecretKeyToX25519=n.convertPublicKeyToX25519=n.verify=n.sign=n.extractPublicKeyFromSecretKey=n.generateKeyPair=n.generateKeyPairFromSeed=n.SEED_LENGTH=n.SECRET_KEY_LENGTH=n.PUBLIC_KEY_LENGTH=n.SIGNATURE_LENGTH=void 0;const e=ps,t=Os,r=gs;n.SIGNATURE_LENGTH=64,n.PUBLIC_KEY_LENGTH=32,n.SECRET_KEY_LENGTH=64,n.SEED_LENGTH=32;function s(y){const p=new Float64Array(16);if(y)for(let d=0;d<y.length;d++)p[d]=y[d];return p}const o=new Uint8Array(32);o[0]=9;const c=s(),u=s([1]),m=s([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=s([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),g=s([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),w=s([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),I=s([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function O(y,p){for(let d=0;d<16;d++)y[d]=p[d]|0}function _(y){let p=1;for(let d=0;d<16;d++){let i=y[d]+p+65535;p=Math.floor(i/65536),y[d]=i-p*65536}y[0]+=p-1+37*(p-1)}function C(y,p,d){const i=~(d-1);for(let h=0;h<16;h++){const M=i&(y[h]^p[h]);y[h]^=M,p[h]^=M}}function $(y,p){const d=s(),i=s();for(let h=0;h<16;h++)i[h]=p[h];_(i),_(i),_(i);for(let h=0;h<2;h++){d[0]=i[0]-65517;for(let R=1;R<15;R++)d[R]=i[R]-65535-(d[R-1]>>16&1),d[R-1]&=65535;d[15]=i[15]-32767-(d[14]>>16&1);const M=d[15]>>16&1;d[14]&=65535,C(i,d,1-M)}for(let h=0;h<16;h++)y[2*h]=i[h]&255,y[2*h+1]=i[h]>>8}function K(y,p){let d=0;for(let i=0;i<32;i++)d|=y[i]^p[i];return(1&d-1>>>8)-1}function D(y,p){const d=new Uint8Array(32),i=new Uint8Array(32);return $(d,y),$(i,p),K(d,i)}function V(y){const p=new Uint8Array(32);return $(p,y),p[0]&1}function te(y,p){for(let d=0;d<16;d++)y[d]=p[2*d]+(p[2*d+1]<<8);y[15]&=32767}function F(y,p,d){for(let i=0;i<16;i++)y[i]=p[i]+d[i]}function U(y,p,d){for(let i=0;i<16;i++)y[i]=p[i]-d[i]}function z(y,p,d){let i,h,M=0,R=0,k=0,G=0,B=0,W=0,Re=0,me=0,Le=0,xe=0,be=0,he=0,oe=0,se=0,Q=0,J=0,le=0,_e=0,Y=0,Ke=0,$e=0,Fe=0,qe=0,He=0,it=0,at=0,lt=0,Ge=0,yt=0,St=0,Kt=0,fe=d[0],re=d[1],ue=d[2],de=d[3],ge=d[4],ne=d[5],Ie=d[6],Ee=d[7],Se=d[8],Pe=d[9],Te=d[10],we=d[11],pe=d[12],Z=d[13],Ae=d[14],Oe=d[15];i=p[0],M+=i*fe,R+=i*re,k+=i*ue,G+=i*de,B+=i*ge,W+=i*ne,Re+=i*Ie,me+=i*Ee,Le+=i*Se,xe+=i*Pe,be+=i*Te,he+=i*we,oe+=i*pe,se+=i*Z,Q+=i*Ae,J+=i*Oe,i=p[1],R+=i*fe,k+=i*re,G+=i*ue,B+=i*de,W+=i*ge,Re+=i*ne,me+=i*Ie,Le+=i*Ee,xe+=i*Se,be+=i*Pe,he+=i*Te,oe+=i*we,se+=i*pe,Q+=i*Z,J+=i*Ae,le+=i*Oe,i=p[2],k+=i*fe,G+=i*re,B+=i*ue,W+=i*de,Re+=i*ge,me+=i*ne,Le+=i*Ie,xe+=i*Ee,be+=i*Se,he+=i*Pe,oe+=i*Te,se+=i*we,Q+=i*pe,J+=i*Z,le+=i*Ae,_e+=i*Oe,i=p[3],G+=i*fe,B+=i*re,W+=i*ue,Re+=i*de,me+=i*ge,Le+=i*ne,xe+=i*Ie,be+=i*Ee,he+=i*Se,oe+=i*Pe,se+=i*Te,Q+=i*we,J+=i*pe,le+=i*Z,_e+=i*Ae,Y+=i*Oe,i=p[4],B+=i*fe,W+=i*re,Re+=i*ue,me+=i*de,Le+=i*ge,xe+=i*ne,be+=i*Ie,he+=i*Ee,oe+=i*Se,se+=i*Pe,Q+=i*Te,J+=i*we,le+=i*pe,_e+=i*Z,Y+=i*Ae,Ke+=i*Oe,i=p[5],W+=i*fe,Re+=i*re,me+=i*ue,Le+=i*de,xe+=i*ge,be+=i*ne,he+=i*Ie,oe+=i*Ee,se+=i*Se,Q+=i*Pe,J+=i*Te,le+=i*we,_e+=i*pe,Y+=i*Z,Ke+=i*Ae,$e+=i*Oe,i=p[6],Re+=i*fe,me+=i*re,Le+=i*ue,xe+=i*de,be+=i*ge,he+=i*ne,oe+=i*Ie,se+=i*Ee,Q+=i*Se,J+=i*Pe,le+=i*Te,_e+=i*we,Y+=i*pe,Ke+=i*Z,$e+=i*Ae,Fe+=i*Oe,i=p[7],me+=i*fe,Le+=i*re,xe+=i*ue,be+=i*de,he+=i*ge,oe+=i*ne,se+=i*Ie,Q+=i*Ee,J+=i*Se,le+=i*Pe,_e+=i*Te,Y+=i*we,Ke+=i*pe,$e+=i*Z,Fe+=i*Ae,qe+=i*Oe,i=p[8],Le+=i*fe,xe+=i*re,be+=i*ue,he+=i*de,oe+=i*ge,se+=i*ne,Q+=i*Ie,J+=i*Ee,le+=i*Se,_e+=i*Pe,Y+=i*Te,Ke+=i*we,$e+=i*pe,Fe+=i*Z,qe+=i*Ae,He+=i*Oe,i=p[9],xe+=i*fe,be+=i*re,he+=i*ue,oe+=i*de,se+=i*ge,Q+=i*ne,J+=i*Ie,le+=i*Ee,_e+=i*Se,Y+=i*Pe,Ke+=i*Te,$e+=i*we,Fe+=i*pe,qe+=i*Z,He+=i*Ae,it+=i*Oe,i=p[10],be+=i*fe,he+=i*re,oe+=i*ue,se+=i*de,Q+=i*ge,J+=i*ne,le+=i*Ie,_e+=i*Ee,Y+=i*Se,Ke+=i*Pe,$e+=i*Te,Fe+=i*we,qe+=i*pe,He+=i*Z,it+=i*Ae,at+=i*Oe,i=p[11],he+=i*fe,oe+=i*re,se+=i*ue,Q+=i*de,J+=i*ge,le+=i*ne,_e+=i*Ie,Y+=i*Ee,Ke+=i*Se,$e+=i*Pe,Fe+=i*Te,qe+=i*we,He+=i*pe,it+=i*Z,at+=i*Ae,lt+=i*Oe,i=p[12],oe+=i*fe,se+=i*re,Q+=i*ue,J+=i*de,le+=i*ge,_e+=i*ne,Y+=i*Ie,Ke+=i*Ee,$e+=i*Se,Fe+=i*Pe,qe+=i*Te,He+=i*we,it+=i*pe,at+=i*Z,lt+=i*Ae,Ge+=i*Oe,i=p[13],se+=i*fe,Q+=i*re,J+=i*ue,le+=i*de,_e+=i*ge,Y+=i*ne,Ke+=i*Ie,$e+=i*Ee,Fe+=i*Se,qe+=i*Pe,He+=i*Te,it+=i*we,at+=i*pe,lt+=i*Z,Ge+=i*Ae,yt+=i*Oe,i=p[14],Q+=i*fe,J+=i*re,le+=i*ue,_e+=i*de,Y+=i*ge,Ke+=i*ne,$e+=i*Ie,Fe+=i*Ee,qe+=i*Se,He+=i*Pe,it+=i*Te,at+=i*we,lt+=i*pe,Ge+=i*Z,yt+=i*Ae,St+=i*Oe,i=p[15],J+=i*fe,le+=i*re,_e+=i*ue,Y+=i*de,Ke+=i*ge,$e+=i*ne,Fe+=i*Ie,qe+=i*Ee,He+=i*Se,it+=i*Pe,at+=i*Te,lt+=i*we,Ge+=i*pe,yt+=i*Z,St+=i*Ae,Kt+=i*Oe,M+=38*le,R+=38*_e,k+=38*Y,G+=38*Ke,B+=38*$e,W+=38*Fe,Re+=38*qe,me+=38*He,Le+=38*it,xe+=38*at,be+=38*lt,he+=38*Ge,oe+=38*yt,se+=38*St,Q+=38*Kt,h=1,i=M+h+65535,h=Math.floor(i/65536),M=i-h*65536,i=R+h+65535,h=Math.floor(i/65536),R=i-h*65536,i=k+h+65535,h=Math.floor(i/65536),k=i-h*65536,i=G+h+65535,h=Math.floor(i/65536),G=i-h*65536,i=B+h+65535,h=Math.floor(i/65536),B=i-h*65536,i=W+h+65535,h=Math.floor(i/65536),W=i-h*65536,i=Re+h+65535,h=Math.floor(i/65536),Re=i-h*65536,i=me+h+65535,h=Math.floor(i/65536),me=i-h*65536,i=Le+h+65535,h=Math.floor(i/65536),Le=i-h*65536,i=xe+h+65535,h=Math.floor(i/65536),xe=i-h*65536,i=be+h+65535,h=Math.floor(i/65536),be=i-h*65536,i=he+h+65535,h=Math.floor(i/65536),he=i-h*65536,i=oe+h+65535,h=Math.floor(i/65536),oe=i-h*65536,i=se+h+65535,h=Math.floor(i/65536),se=i-h*65536,i=Q+h+65535,h=Math.floor(i/65536),Q=i-h*65536,i=J+h+65535,h=Math.floor(i/65536),J=i-h*65536,M+=h-1+37*(h-1),h=1,i=M+h+65535,h=Math.floor(i/65536),M=i-h*65536,i=R+h+65535,h=Math.floor(i/65536),R=i-h*65536,i=k+h+65535,h=Math.floor(i/65536),k=i-h*65536,i=G+h+65535,h=Math.floor(i/65536),G=i-h*65536,i=B+h+65535,h=Math.floor(i/65536),B=i-h*65536,i=W+h+65535,h=Math.floor(i/65536),W=i-h*65536,i=Re+h+65535,h=Math.floor(i/65536),Re=i-h*65536,i=me+h+65535,h=Math.floor(i/65536),me=i-h*65536,i=Le+h+65535,h=Math.floor(i/65536),Le=i-h*65536,i=xe+h+65535,h=Math.floor(i/65536),xe=i-h*65536,i=be+h+65535,h=Math.floor(i/65536),be=i-h*65536,i=he+h+65535,h=Math.floor(i/65536),he=i-h*65536,i=oe+h+65535,h=Math.floor(i/65536),oe=i-h*65536,i=se+h+65535,h=Math.floor(i/65536),se=i-h*65536,i=Q+h+65535,h=Math.floor(i/65536),Q=i-h*65536,i=J+h+65535,h=Math.floor(i/65536),J=i-h*65536,M+=h-1+37*(h-1),y[0]=M,y[1]=R,y[2]=k,y[3]=G,y[4]=B,y[5]=W,y[6]=Re,y[7]=me,y[8]=Le,y[9]=xe,y[10]=be,y[11]=he,y[12]=oe,y[13]=se,y[14]=Q,y[15]=J}function q(y,p){z(y,p,p)}function je(y,p){const d=s();let i;for(i=0;i<16;i++)d[i]=p[i];for(i=253;i>=0;i--)q(d,d),i!==2&&i!==4&&z(d,d,p);for(i=0;i<16;i++)y[i]=d[i]}function ve(y,p){const d=s();let i;for(i=0;i<16;i++)d[i]=p[i];for(i=250;i>=0;i--)q(d,d),i!==1&&z(d,d,p);for(i=0;i<16;i++)y[i]=d[i]}function Ve(y,p){const d=s(),i=s(),h=s(),M=s(),R=s(),k=s(),G=s(),B=s(),W=s();U(d,y[1],y[0]),U(W,p[1],p[0]),z(d,d,W),F(i,y[0],y[1]),F(W,p[0],p[1]),z(i,i,W),z(h,y[3],p[3]),z(h,h,l),z(M,y[2],p[2]),F(M,M,M),U(R,i,d),U(k,M,h),F(G,M,h),F(B,i,d),z(y[0],R,k),z(y[1],B,G),z(y[2],G,k),z(y[3],R,B)}function ke(y,p,d){for(let i=0;i<4;i++)C(y[i],p[i],d)}function tt(y,p){const d=s(),i=s(),h=s();je(h,p[2]),z(d,p[0],h),z(i,p[1],h),$(y,i),y[31]^=V(d)<<7}function x(y,p,d){O(y[0],c),O(y[1],u),O(y[2],u),O(y[3],c);for(let i=255;i>=0;--i){const h=d[i/8|0]>>(i&7)&1;ke(y,p,h),Ve(p,y),Ve(y,y),ke(y,p,h)}}function v(y,p){const d=[s(),s(),s(),s()];O(d[0],g),O(d[1],w),O(d[2],u),z(d[3],g,w),x(y,d,p)}function ie(y){if(y.length!==n.SEED_LENGTH)throw new Error(`ed25519: seed must be ${n.SEED_LENGTH} bytes`);const p=(0,t.hash)(y);p[0]&=248,p[31]&=127,p[31]|=64;const d=new Uint8Array(32),i=[s(),s(),s(),s()];v(i,p),tt(d,i);const h=new Uint8Array(64);return h.set(y),h.set(d,32),{publicKey:d,secretKey:h}}n.generateKeyPairFromSeed=ie;function ye(y){const p=(0,e.randomBytes)(32,y),d=ie(p);return(0,r.wipe)(p),d}n.generateKeyPair=ye;function A(y){if(y.length!==n.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${n.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(y.subarray(32))}n.extractPublicKeyFromSecretKey=A;const E=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function S(y,p){let d,i,h,M;for(i=63;i>=32;--i){for(d=0,h=i-32,M=i-12;h<M;++h)p[h]+=d-16*p[i]*E[h-(i-32)],d=Math.floor((p[h]+128)/256),p[h]-=d*256;p[h]+=d,p[i]=0}for(d=0,h=0;h<32;h++)p[h]+=d-(p[31]>>4)*E[h],d=p[h]>>8,p[h]&=255;for(h=0;h<32;h++)p[h]-=d*E[h];for(i=0;i<32;i++)p[i+1]+=p[i]>>8,y[i]=p[i]&255}function T(y){const p=new Float64Array(64);for(let d=0;d<64;d++)p[d]=y[d];for(let d=0;d<64;d++)y[d]=0;S(y,p)}function Ce(y,p){const d=new Float64Array(64),i=[s(),s(),s(),s()],h=(0,t.hash)(y.subarray(0,32));h[0]&=248,h[31]&=127,h[31]|=64;const M=new Uint8Array(64);M.set(h.subarray(32),32);const R=new t.SHA512;R.update(M.subarray(32)),R.update(p);const k=R.digest();R.clean(),T(k),v(i,k),tt(M,i),R.reset(),R.update(M.subarray(0,32)),R.update(y.subarray(32)),R.update(p);const G=R.digest();T(G);for(let B=0;B<32;B++)d[B]=k[B];for(let B=0;B<32;B++)for(let W=0;W<32;W++)d[B+W]+=G[B]*h[W];return S(M.subarray(32),d),M}n.sign=Ce;function ce(y,p){const d=s(),i=s(),h=s(),M=s(),R=s(),k=s(),G=s();return O(y[2],u),te(y[1],p),q(h,y[1]),z(M,h,m),U(h,h,y[2]),F(M,y[2],M),q(R,M),q(k,R),z(G,k,R),z(d,G,h),z(d,d,M),ve(d,d),z(d,d,h),z(d,d,M),z(d,d,M),z(y[0],d,M),q(i,y[0]),z(i,i,M),D(i,h)&&z(y[0],y[0],I),q(i,y[0]),z(i,i,M),D(i,h)?-1:(V(y[0])===p[31]>>7&&U(y[0],c,y[0]),z(y[3],y[0],y[1]),0)}function Et(y,p,d){const i=new Uint8Array(32),h=[s(),s(),s(),s()],M=[s(),s(),s(),s()];if(d.length!==n.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${n.SIGNATURE_LENGTH} bytes`);if(ce(M,y))return!1;const R=new t.SHA512;R.update(d.subarray(0,32)),R.update(y),R.update(p);const k=R.digest();return T(k),x(h,M,k),v(M,d.subarray(32)),Ve(h,M),tt(i,h),!K(d,i)}n.verify=Et;function H(y){let p=[s(),s(),s(),s()];if(ce(p,y))throw new Error("Ed25519: invalid public key");let d=s(),i=s(),h=p[1];F(d,u,h),U(i,u,h),je(i,i),z(d,d,i);let M=new Uint8Array(32);return $(M,d),M}n.convertPublicKeyToX25519=H;function xt(y){const p=(0,t.hash)(y.subarray(0,32));p[0]&=248,p[31]&=127,p[31]|=64;const d=new Uint8Array(p.subarray(0,32));return(0,r.wipe)(p),d}n.convertSecretKeyToX25519=xt})(xi);const sa="EdDSA",ra="JWT",Ms=".",zs="base64url",na="utf8",aa="utf8",oa=":",ca="did",ha="key",qi="base58btc",la="z",fa="K36",ua=32;function Xt(n){return ei(wi(Rt(n),na),zs)}function Cs(n){const e=wi(fa,qi),t=la+ei(Lr([e,n]),qi);return[ca,ha,t].join(oa)}function da(n){return ei(n,zs)}function ga(n){return wi([Xt(n.header),Xt(n.payload)].join(Ms),aa)}function pa(n){return[Xt(n.header),Xt(n.payload),da(n.signature)].join(Ms)}function Gi(n=ps.randomBytes(ua)){return xi.generateKeyPairFromSeed(n)}async function ya(n,e,t,r,s=N.fromMiliseconds(Date.now())){const o={alg:sa,typ:ra},c=Cs(r.publicKey),u=s+t,m={iss:c,sub:n,aud:e,iat:s,exp:u},l=ga({header:o,payload:m}),g=xi.sign(r.secretKey,l);return pa({header:o,payload:m,signature:g})}const ma=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),ba=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",Wi=n=>n.split("?")[0],Ji=10,wa=ma();let va=class{constructor(e){if(this.url=e,this.events=new pt.EventEmitter,this.registering=!1,!Li(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,t)=>{if(typeof this.socket>"u"){t(new Error("Connection already closed"));return}this.socket.onclose=r=>{this.onClose(r),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Rt(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Li(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const t=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=t||this.events.listenerCount("open")>=t)&&this.events.setMaxListeners(t+1),new Promise((r,s)=>{this.events.once("register_error",o=>{this.resetMaxListeners(),s(o)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return s(new Error("WebSocket connection is missing or invalid"));r(this.socket)})})}return this.url=e,this.registering=!0,new Promise((t,r)=>{const s=new URLSearchParams(e).get("origin"),o=Dr.isReactNative()?{headers:{origin:s}}:{rejectUnauthorized:!Nr(e)},c=new wa(e,[],o);ba()?c.onerror=u=>{const m=u;r(this.emitError(m.error))}:c.on("error",u=>{r(this.emitError(u))}),c.onopen=()=>{this.onOpen(c),t(c)}})}onOpen(e){e.onmessage=t=>this.onPayload(t),e.onclose=t=>this.onClose(t),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const t=typeof e.data=="string"?Qt(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const r=this.parseError(t),s=r.message||r.toString(),o=ys(e,s);this.events.emit("payload",o)}parseError(e,t=this.url){return Kr(e,Wi(t),"WS")}resetMaxListeners(){this.events.getMaxListeners()>Ji&&this.events.setMaxListeners(Ji)}emitError(e){const t=this.parseError(new Error((e==null?void 0:e.message)||`WebSocket connection failed for host: ${Wi(this.url)}`));return this.events.emit("register_error",t),t}};var Zt={exports:{}};Zt.exports;(function(n,e){var t=200,r="__lodash_hash_undefined__",s=1,o=2,c=9007199254740991,u="[object Arguments]",m="[object Array]",l="[object AsyncFunction]",g="[object Boolean]",w="[object Date]",I="[object Error]",O="[object Function]",_="[object GeneratorFunction]",C="[object Map]",$="[object Number]",K="[object Null]",D="[object Object]",V="[object Promise]",te="[object Proxy]",F="[object RegExp]",U="[object Set]",z="[object String]",q="[object Symbol]",je="[object Undefined]",ve="[object WeakMap]",Ve="[object ArrayBuffer]",ke="[object DataView]",tt="[object Float32Array]",x="[object Float64Array]",v="[object Int8Array]",ie="[object Int16Array]",ye="[object Int32Array]",A="[object Uint8Array]",E="[object Uint8ClampedArray]",S="[object Uint16Array]",T="[object Uint32Array]",Ce=/[\\^$.*+?()[\]{}|]/g,ce=/^\[object .+?Constructor\]$/,Et=/^(?:0|[1-9]\d*)$/,H={};H[tt]=H[x]=H[v]=H[ie]=H[ye]=H[A]=H[E]=H[S]=H[T]=!0,H[u]=H[m]=H[Ve]=H[g]=H[ke]=H[w]=H[I]=H[O]=H[C]=H[$]=H[D]=H[F]=H[U]=H[z]=H[ve]=!1;var xt=typeof Ft=="object"&&Ft&&Ft.Object===Object&&Ft,y=typeof self=="object"&&self&&self.Object===Object&&self,p=xt||y||Function("return this")(),d=e&&!e.nodeType&&e,i=d&&!0&&n&&!n.nodeType&&n,h=i&&i.exports===d,M=h&&xt.process,R=function(){try{return M&&M.binding&&M.binding("util")}catch{}}(),k=R&&R.isTypedArray;function G(a,f){for(var b=-1,P=a==null?0:a.length,X=0,L=[];++b<P;){var ae=a[b];f(ae,b,a)&&(L[X++]=ae)}return L}function B(a,f){for(var b=-1,P=f.length,X=a.length;++b<P;)a[X+b]=f[b];return a}function W(a,f){for(var b=-1,P=a==null?0:a.length;++b<P;)if(f(a[b],b,a))return!0;return!1}function Re(a,f){for(var b=-1,P=Array(a);++b<a;)P[b]=f(b);return P}function me(a){return function(f){return a(f)}}function Le(a,f){return a.has(f)}function xe(a,f){return a==null?void 0:a[f]}function be(a){var f=-1,b=Array(a.size);return a.forEach(function(P,X){b[++f]=[X,P]}),b}function he(a,f){return function(b){return a(f(b))}}function oe(a){var f=-1,b=Array(a.size);return a.forEach(function(P){b[++f]=P}),b}var se=Array.prototype,Q=Function.prototype,J=Object.prototype,le=p["__core-js_shared__"],_e=Q.toString,Y=J.hasOwnProperty,Ke=function(){var a=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return a?"Symbol(src)_1."+a:""}(),$e=J.toString,Fe=RegExp("^"+_e.call(Y).replace(Ce,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),qe=h?p.Buffer:void 0,He=p.Symbol,it=p.Uint8Array,at=J.propertyIsEnumerable,lt=se.splice,Ge=He?He.toStringTag:void 0,yt=Object.getOwnPropertySymbols,St=qe?qe.isBuffer:void 0,Kt=he(Object.keys,Object),fe=_t(p,"DataView"),re=_t(p,"Map"),ue=_t(p,"Promise"),de=_t(p,"Set"),ge=_t(p,"WeakMap"),ne=_t(Object,"create"),Ie=bt(fe),Ee=bt(re),Se=bt(ue),Pe=bt(de),Te=bt(ge),we=He?He.prototype:void 0,pe=we?we.valueOf:void 0;function Z(a){var f=-1,b=a==null?0:a.length;for(this.clear();++f<b;){var P=a[f];this.set(P[0],P[1])}}function Ae(){this.__data__=ne?ne(null):{},this.size=0}function Oe(a){var f=this.has(a)&&delete this.__data__[a];return this.size-=f?1:0,f}function qs(a){var f=this.__data__;if(ne){var b=f[a];return b===r?void 0:b}return Y.call(f,a)?f[a]:void 0}function Gs(a){var f=this.__data__;return ne?f[a]!==void 0:Y.call(f,a)}function Ws(a,f){var b=this.__data__;return this.size+=this.has(a)?0:1,b[a]=ne&&f===void 0?r:f,this}Z.prototype.clear=Ae,Z.prototype.delete=Oe,Z.prototype.get=qs,Z.prototype.has=Gs,Z.prototype.set=Ws;function ct(a){var f=-1,b=a==null?0:a.length;for(this.clear();++f<b;){var P=a[f];this.set(P[0],P[1])}}function Js(){this.__data__=[],this.size=0}function Vs(a){var f=this.__data__,b=$t(f,a);if(b<0)return!1;var P=f.length-1;return b==P?f.pop():lt.call(f,b,1),--this.size,!0}function Ys(a){var f=this.__data__,b=$t(f,a);return b<0?void 0:f[b][1]}function Xs(a){return $t(this.__data__,a)>-1}function Zs(a,f){var b=this.__data__,P=$t(b,a);return P<0?(++this.size,b.push([a,f])):b[P][1]=f,this}ct.prototype.clear=Js,ct.prototype.delete=Vs,ct.prototype.get=Ys,ct.prototype.has=Xs,ct.prototype.set=Zs;function mt(a){var f=-1,b=a==null?0:a.length;for(this.clear();++f<b;){var P=a[f];this.set(P[0],P[1])}}function Qs(){this.size=0,this.__data__={hash:new Z,map:new(re||ct),string:new Z}}function er(a){var f=jt(this,a).delete(a);return this.size-=f?1:0,f}function tr(a){return jt(this,a).get(a)}function ir(a){return jt(this,a).has(a)}function sr(a,f){var b=jt(this,a),P=b.size;return b.set(a,f),this.size+=b.size==P?0:1,this}mt.prototype.clear=Qs,mt.prototype.delete=er,mt.prototype.get=tr,mt.prototype.has=ir,mt.prototype.set=sr;function Ut(a){var f=-1,b=a==null?0:a.length;for(this.__data__=new mt;++f<b;)this.add(a[f])}function rr(a){return this.__data__.set(a,r),this}function nr(a){return this.__data__.has(a)}Ut.prototype.add=Ut.prototype.push=rr,Ut.prototype.has=nr;function ft(a){var f=this.__data__=new ct(a);this.size=f.size}function ar(){this.__data__=new ct,this.size=0}function or(a){var f=this.__data__,b=f.delete(a);return this.size=f.size,b}function cr(a){return this.__data__.get(a)}function hr(a){return this.__data__.has(a)}function lr(a,f){var b=this.__data__;if(b instanceof ct){var P=b.__data__;if(!re||P.length<t-1)return P.push([a,f]),this.size=++b.size,this;b=this.__data__=new mt(P)}return b.set(a,f),this.size=b.size,this}ft.prototype.clear=ar,ft.prototype.delete=or,ft.prototype.get=cr,ft.prototype.has=hr,ft.prototype.set=lr;function fr(a,f){var b=Ht(a),P=!b&&Pr(a),X=!b&&!P&&ii(a),L=!b&&!P&&!X&&Ci(a),ae=b||P||X||L,Me=ae?Re(a.length,String):[],De=Me.length;for(var ee in a)Y.call(a,ee)&&!(ae&&(ee=="length"||X&&(ee=="offset"||ee=="parent")||L&&(ee=="buffer"||ee=="byteLength"||ee=="byteOffset")||xr(ee,De)))&&Me.push(ee);return Me}function $t(a,f){for(var b=a.length;b--;)if(Ai(a[b][0],f))return b;return-1}function ur(a,f,b){var P=f(a);return Ht(a)?P:B(P,b(a))}function Pt(a){return a==null?a===void 0?je:K:Ge&&Ge in Object(a)?wr(a):Sr(a)}function Ei(a){return Tt(a)&&Pt(a)==u}function Si(a,f,b,P,X){return a===f?!0:a==null||f==null||!Tt(a)&&!Tt(f)?a!==a&&f!==f:dr(a,f,b,P,Si,X)}function dr(a,f,b,P,X,L){var ae=Ht(a),Me=Ht(f),De=ae?m:ut(a),ee=Me?m:ut(f);De=De==u?D:De,ee=ee==u?D:ee;var We=De==D,st=ee==D,Ue=De==ee;if(Ue&&ii(a)){if(!ii(f))return!1;ae=!0,We=!1}if(Ue&&!We)return L||(L=new ft),ae||Ci(a)?Pi(a,f,b,P,X,L):mr(a,f,De,b,P,X,L);if(!(b&s)){var Ye=We&&Y.call(a,"__wrapped__"),Xe=st&&Y.call(f,"__wrapped__");if(Ye||Xe){var dt=Ye?a.value():a,ht=Xe?f.value():f;return L||(L=new ft),X(dt,ht,b,P,L)}}return Ue?(L||(L=new ft),br(a,f,b,P,X,L)):!1}function gr(a){if(!zi(a)||Ir(a))return!1;var f=Oi(a)?Fe:ce;return f.test(bt(a))}function pr(a){return Tt(a)&&Mi(a.length)&&!!H[Pt(a)]}function yr(a){if(!Er(a))return Kt(a);var f=[];for(var b in Object(a))Y.call(a,b)&&b!="constructor"&&f.push(b);return f}function Pi(a,f,b,P,X,L){var ae=b&s,Me=a.length,De=f.length;if(Me!=De&&!(ae&&De>Me))return!1;var ee=L.get(a);if(ee&&L.get(f))return ee==f;var We=-1,st=!0,Ue=b&o?new Ut:void 0;for(L.set(a,f),L.set(f,a);++We<Me;){var Ye=a[We],Xe=f[We];if(P)var dt=ae?P(Xe,Ye,We,f,a,L):P(Ye,Xe,We,a,f,L);if(dt!==void 0){if(dt)continue;st=!1;break}if(Ue){if(!W(f,function(ht,wt){if(!Le(Ue,wt)&&(Ye===ht||X(Ye,ht,b,P,L)))return Ue.push(wt)})){st=!1;break}}else if(!(Ye===Xe||X(Ye,Xe,b,P,L))){st=!1;break}}return L.delete(a),L.delete(f),st}function mr(a,f,b,P,X,L,ae){switch(b){case ke:if(a.byteLength!=f.byteLength||a.byteOffset!=f.byteOffset)return!1;a=a.buffer,f=f.buffer;case Ve:return!(a.byteLength!=f.byteLength||!L(new it(a),new it(f)));case g:case w:case $:return Ai(+a,+f);case I:return a.name==f.name&&a.message==f.message;case F:case z:return a==f+"";case C:var Me=be;case U:var De=P&s;if(Me||(Me=oe),a.size!=f.size&&!De)return!1;var ee=ae.get(a);if(ee)return ee==f;P|=o,ae.set(a,f);var We=Pi(Me(a),Me(f),P,X,L,ae);return ae.delete(a),We;case q:if(pe)return pe.call(a)==pe.call(f)}return!1}function br(a,f,b,P,X,L){var ae=b&s,Me=Ti(a),De=Me.length,ee=Ti(f),We=ee.length;if(De!=We&&!ae)return!1;for(var st=De;st--;){var Ue=Me[st];if(!(ae?Ue in f:Y.call(f,Ue)))return!1}var Ye=L.get(a);if(Ye&&L.get(f))return Ye==f;var Xe=!0;L.set(a,f),L.set(f,a);for(var dt=ae;++st<De;){Ue=Me[st];var ht=a[Ue],wt=f[Ue];if(P)var Ri=ae?P(wt,ht,Ue,f,a,L):P(ht,wt,Ue,a,f,L);if(!(Ri===void 0?ht===wt||X(ht,wt,b,P,L):Ri)){Xe=!1;break}dt||(dt=Ue=="constructor")}if(Xe&&!dt){var Bt=a.constructor,kt=f.constructor;Bt!=kt&&"constructor"in a&&"constructor"in f&&!(typeof Bt=="function"&&Bt instanceof Bt&&typeof kt=="function"&&kt instanceof kt)&&(Xe=!1)}return L.delete(a),L.delete(f),Xe}function Ti(a){return ur(a,Or,vr)}function jt(a,f){var b=a.__data__;return _r(f)?b[typeof f=="string"?"string":"hash"]:b.map}function _t(a,f){var b=xe(a,f);return gr(b)?b:void 0}function wr(a){var f=Y.call(a,Ge),b=a[Ge];try{a[Ge]=void 0;var P=!0}catch{}var X=$e.call(a);return P&&(f?a[Ge]=b:delete a[Ge]),X}var vr=yt?function(a){return a==null?[]:(a=Object(a),G(yt(a),function(f){return at.call(a,f)}))}:Mr,ut=Pt;(fe&&ut(new fe(new ArrayBuffer(1)))!=ke||re&&ut(new re)!=C||ue&&ut(ue.resolve())!=V||de&&ut(new de)!=U||ge&&ut(new ge)!=ve)&&(ut=function(a){var f=Pt(a),b=f==D?a.constructor:void 0,P=b?bt(b):"";if(P)switch(P){case Ie:return ke;case Ee:return C;case Se:return V;case Pe:return U;case Te:return ve}return f});function xr(a,f){return f=f??c,!!f&&(typeof a=="number"||Et.test(a))&&a>-1&&a%1==0&&a<f}function _r(a){var f=typeof a;return f=="string"||f=="number"||f=="symbol"||f=="boolean"?a!=="__proto__":a===null}function Ir(a){return!!Ke&&Ke in a}function Er(a){var f=a&&a.constructor,b=typeof f=="function"&&f.prototype||J;return a===b}function Sr(a){return $e.call(a)}function bt(a){if(a!=null){try{return _e.call(a)}catch{}try{return a+""}catch{}}return""}function Ai(a,f){return a===f||a!==a&&f!==f}var Pr=Ei(function(){return arguments}())?Ei:function(a){return Tt(a)&&Y.call(a,"callee")&&!at.call(a,"callee")},Ht=Array.isArray;function Tr(a){return a!=null&&Mi(a.length)&&!Oi(a)}var ii=St||zr;function Ar(a,f){return Si(a,f)}function Oi(a){if(!zi(a))return!1;var f=Pt(a);return f==O||f==_||f==l||f==te}function Mi(a){return typeof a=="number"&&a>-1&&a%1==0&&a<=c}function zi(a){var f=typeof a;return a!=null&&(f=="object"||f=="function")}function Tt(a){return a!=null&&typeof a=="object"}var Ci=k?me(k):pr;function Or(a){return Tr(a)?fr(a):yr(a)}function Mr(){return[]}function zr(){return!1}n.exports=Ar})(Zt,Zt.exports);var xa=Zt.exports;const _a=ms(xa);function Ia(n,e){return e=e||{},new Promise(function(t,r){var s=new XMLHttpRequest,o=[],c=[],u={},m=function(){return{ok:(s.status/100|0)==2,statusText:s.statusText,status:s.status,url:s.responseURL,text:function(){return Promise.resolve(s.responseText)},json:function(){return Promise.resolve(s.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([s.response]))},clone:m,headers:{keys:function(){return o},entries:function(){return c},get:function(g){return u[g.toLowerCase()]},has:function(g){return g.toLowerCase()in u}}}};for(var l in s.open(e.method||"get",n,!0),s.onload=function(){s.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(g,w,I){o.push(w=w.toLowerCase()),c.push([w,I]),u[w]=u[w]?u[w]+","+I:I}),t(m())},s.onerror=r,s.withCredentials=e.credentials=="include",e.headers)s.setRequestHeader(l,e.headers[l]);s.send(e.body||null)})}const Ea=Object.freeze(Object.defineProperty({__proto__:null,default:Ia},Symbol.toStringTag,{value:"Module"})),Vi=Ur(Ea);var Sa=self.fetch||(self.fetch=Vi.default||Vi);const Pa=ms(Sa);var Ta={};function Aa(n,e){if(n.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),r=0;r<t.length;r++)t[r]=255;for(var s=0;s<n.length;s++){var o=n.charAt(s),c=o.charCodeAt(0);if(t[c]!==255)throw new TypeError(o+" is ambiguous");t[c]=s}var u=n.length,m=n.charAt(0),l=Math.log(u)/Math.log(256),g=Math.log(256)/Math.log(u);function w(_){if(_ instanceof Uint8Array||(ArrayBuffer.isView(_)?_=new Uint8Array(_.buffer,_.byteOffset,_.byteLength):Array.isArray(_)&&(_=Uint8Array.from(_))),!(_ instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(_.length===0)return"";for(var C=0,$=0,K=0,D=_.length;K!==D&&_[K]===0;)K++,C++;for(var V=(D-K)*g+1>>>0,te=new Uint8Array(V);K!==D;){for(var F=_[K],U=0,z=V-1;(F!==0||U<$)&&z!==-1;z--,U++)F+=256*te[z]>>>0,te[z]=F%u>>>0,F=F/u>>>0;if(F!==0)throw new Error("Non-zero carry");$=U,K++}for(var q=V-$;q!==V&&te[q]===0;)q++;for(var je=m.repeat(C);q<V;++q)je+=n.charAt(te[q]);return je}function I(_){if(typeof _!="string")throw new TypeError("Expected String");if(_.length===0)return new Uint8Array;var C=0;if(_[C]!==" "){for(var $=0,K=0;_[C]===m;)$++,C++;for(var D=(_.length-C)*l+1>>>0,V=new Uint8Array(D);_[C];){var te=t[_.charCodeAt(C)];if(te===255)return;for(var F=0,U=D-1;(te!==0||F<K)&&U!==-1;U--,F++)te+=u*V[U]>>>0,V[U]=te%256>>>0,te=te/256>>>0;if(te!==0)throw new Error("Non-zero carry");K=F,C++}if(_[C]!==" "){for(var z=D-K;z!==D&&V[z]===0;)z++;for(var q=new Uint8Array($+(D-z)),je=$;z!==D;)q[je++]=V[z++];return q}}}function O(_){var C=I(_);if(C)return C;throw new Error(`Non-${e} character`)}return{encode:w,decodeUnsafe:I,decode:O}}var Oa=Aa,Ma=Oa;const Rs=n=>{if(n instanceof Uint8Array&&n.constructor.name==="Uint8Array")return n;if(n instanceof ArrayBuffer)return new Uint8Array(n);if(ArrayBuffer.isView(n))return new Uint8Array(n.buffer,n.byteOffset,n.byteLength);throw new Error("Unknown type, must be binary type")},za=n=>new TextEncoder().encode(n),Ca=n=>new TextDecoder().decode(n);class Ra{constructor(e,t,r){this.name=e,this.prefix=t,this.baseEncode=r}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class La{constructor(e,t,r){if(this.name=e,this.prefix=t,t.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=t.codePointAt(0),this.baseDecode=r}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ls(this,e)}}class Da{constructor(e){this.decoders=e}or(e){return Ls(this,e)}decode(e){const t=e[0],r=this.decoders[t];if(r)return r.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ls=(n,e)=>new Da({...n.decoders||{[n.prefix]:n},...e.decoders||{[e.prefix]:e}});class Na{constructor(e,t,r,s){this.name=e,this.prefix=t,this.baseEncode=r,this.baseDecode=s,this.encoder=new Ra(e,t,r),this.decoder=new La(e,t,s)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const ti=({name:n,prefix:e,encode:t,decode:r})=>new Na(n,e,t,r),Nt=({prefix:n,name:e,alphabet:t})=>{const{encode:r,decode:s}=Ma(t,e);return ti({prefix:n,name:e,encode:r,decode:o=>Rs(s(o))})},Ka=(n,e,t,r)=>{const s={};for(let g=0;g<e.length;++g)s[e[g]]=g;let o=n.length;for(;n[o-1]==="=";)--o;const c=new Uint8Array(o*t/8|0);let u=0,m=0,l=0;for(let g=0;g<o;++g){const w=s[n[g]];if(w===void 0)throw new SyntaxError(`Non-${r} character`);m=m<<t|w,u+=t,u>=8&&(u-=8,c[l++]=255&m>>u)}if(u>=t||255&m<<8-u)throw new SyntaxError("Unexpected end of data");return c},Ua=(n,e,t)=>{const r=e[e.length-1]==="=",s=(1<<t)-1;let o="",c=0,u=0;for(let m=0;m<n.length;++m)for(u=u<<8|n[m],c+=8;c>t;)c-=t,o+=e[s&u>>c];if(c&&(o+=e[s&u<<t-c]),r)for(;o.length*t&7;)o+="=";return o},Ne=({name:n,prefix:e,bitsPerChar:t,alphabet:r})=>ti({prefix:e,name:n,encode(s){return Ua(s,r,t)},decode(s){return Ka(s,r,t,n)}}),$a=ti({prefix:"\0",name:"identity",encode:n=>Ca(n),decode:n=>za(n)});var ja=Object.freeze({__proto__:null,identity:$a});const Ha=Ne({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Ba=Object.freeze({__proto__:null,base2:Ha});const ka=Ne({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Fa=Object.freeze({__proto__:null,base8:ka});const qa=Nt({prefix:"9",name:"base10",alphabet:"0123456789"});var Ga=Object.freeze({__proto__:null,base10:qa});const Wa=Ne({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),Ja=Ne({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Va=Object.freeze({__proto__:null,base16:Wa,base16upper:Ja});const Ya=Ne({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Xa=Ne({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Za=Ne({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Qa=Ne({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),eo=Ne({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),to=Ne({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),io=Ne({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),so=Ne({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ro=Ne({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var no=Object.freeze({__proto__:null,base32:Ya,base32upper:Xa,base32pad:Za,base32padupper:Qa,base32hex:eo,base32hexupper:to,base32hexpad:io,base32hexpadupper:so,base32z:ro});const ao=Nt({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),oo=Nt({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var co=Object.freeze({__proto__:null,base36:ao,base36upper:oo});const ho=Nt({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),lo=Nt({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var fo=Object.freeze({__proto__:null,base58btc:ho,base58flickr:lo});const uo=Ne({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),go=Ne({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),po=Ne({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),yo=Ne({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var mo=Object.freeze({__proto__:null,base64:uo,base64pad:go,base64url:po,base64urlpad:yo});const Ds=Array.from(""),bo=Ds.reduce((n,e,t)=>(n[t]=e,n),[]),wo=Ds.reduce((n,e,t)=>(n[e.codePointAt(0)]=t,n),[]);function vo(n){return n.reduce((e,t)=>(e+=bo[t],e),"")}function xo(n){const e=[];for(const t of n){const r=wo[t.codePointAt(0)];if(r===void 0)throw new Error(`Non-base256emoji character: ${t}`);e.push(r)}return new Uint8Array(e)}const _o=ti({prefix:"",name:"base256emoji",encode:vo,decode:xo});var Io=Object.freeze({__proto__:null,base256emoji:_o}),Eo=Ns,Yi=128,So=127,Po=~So,To=Math.pow(2,31);function Ns(n,e,t){e=e||[],t=t||0;for(var r=t;n>=To;)e[t++]=n&255|Yi,n/=128;for(;n&Po;)e[t++]=n&255|Yi,n>>>=7;return e[t]=n|0,Ns.bytes=t-r+1,e}var Ao=yi,Oo=128,Xi=127;function yi(n,r){var t=0,r=r||0,s=0,o=r,c,u=n.length;do{if(o>=u)throw yi.bytes=0,new RangeError("Could not decode varint");c=n[o++],t+=s<28?(c&Xi)<<s:(c&Xi)*Math.pow(2,s),s+=7}while(c>=Oo);return yi.bytes=o-r,t}var Mo=Math.pow(2,7),zo=Math.pow(2,14),Co=Math.pow(2,21),Ro=Math.pow(2,28),Lo=Math.pow(2,35),Do=Math.pow(2,42),No=Math.pow(2,49),Ko=Math.pow(2,56),Uo=Math.pow(2,63),$o=function(n){return n<Mo?1:n<zo?2:n<Co?3:n<Ro?4:n<Lo?5:n<Do?6:n<No?7:n<Ko?8:n<Uo?9:10},jo={encode:Eo,decode:Ao,encodingLength:$o},Ks=jo;const Zi=(n,e,t=0)=>(Ks.encode(n,e,t),e),Qi=n=>Ks.encodingLength(n),mi=(n,e)=>{const t=e.byteLength,r=Qi(n),s=r+Qi(t),o=new Uint8Array(s+t);return Zi(n,o,0),Zi(t,o,r),o.set(e,s),new Ho(n,t,e,o)};class Ho{constructor(e,t,r,s){this.code=e,this.size=t,this.digest=r,this.bytes=s}}const Us=({name:n,code:e,encode:t})=>new Bo(n,e,t);class Bo{constructor(e,t,r){this.name=e,this.code=t,this.encode=r}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?mi(this.code,t):t.then(r=>mi(this.code,r))}else throw Error("Unknown type, must be binary type")}}const $s=n=>async e=>new Uint8Array(await crypto.subtle.digest(n,e)),ko=Us({name:"sha2-256",code:18,encode:$s("SHA-256")}),Fo=Us({name:"sha2-512",code:19,encode:$s("SHA-512")});var qo=Object.freeze({__proto__:null,sha256:ko,sha512:Fo});const js=0,Go="identity",Hs=Rs,Wo=n=>mi(js,Hs(n)),Jo={code:js,name:Go,encode:Hs,digest:Wo};var Vo=Object.freeze({__proto__:null,identity:Jo});new TextEncoder,new TextDecoder;const es={...ja,...Ba,...Fa,...Ga,...Va,...no,...co,...fo,...mo,...Io};({...qo,...Vo});function Yo(n=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?globalThis.Buffer.allocUnsafe(n):new Uint8Array(n)}function Bs(n,e,t,r){return{name:n,prefix:e,encoder:{name:n,prefix:e,encode:t},decoder:{decode:r}}}const ts=Bs("utf8","u",n=>"u"+new TextDecoder("utf8").decode(n),n=>new TextEncoder().encode(n.substring(1))),oi=Bs("ascii","a",n=>{let e="a";for(let t=0;t<n.length;t++)e+=String.fromCharCode(n[t]);return e},n=>{n=n.substring(1);const e=Yo(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}),Xo={utf8:ts,"utf-8":ts,hex:es.base16,latin1:oi,ascii:oi,binary:oi,...es};function Zo(n,e="utf8"){const t=Xo[e];if(!t)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(n,"utf8"):t.decoder.decode(`${t.prefix}${n}`)}const ks="wc",Qo=2,_i="core",gt=`${ks}@2:${_i}:`,ec={name:_i,logger:"error"},tc={database:":memory:"},ic="crypto",is="client_ed25519_seed",sc=N.ONE_DAY,rc="keychain",nc="0.3",ac="messages",oc="0.3",cc=N.SIX_HOURS,hc="publisher",lc="irn",fc="error",Fs="wss://relay.walletconnect.com",ss="wss://relay.walletconnect.org",uc="relayer",Qe={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},dc="_subscription",Ze={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},gc=N.ONE_SECOND,pc="2.13.0",yc=1e4,mc="0.3",bc="WALLETCONNECT_CLIENT_ID",ot={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},wc="subscription",vc="0.3",xc=N.FIVE_SECONDS*1e3,_c="pairing",Ic="0.3",At={wc_pairingDelete:{req:{ttl:N.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:N.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:N.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:N.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:N.ONE_DAY,prompt:!1,tag:0},res:{ttl:N.ONE_DAY,prompt:!1,tag:0}}},Wt={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},rt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},Ec="history",Sc="0.3",Pc="expirer",nt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Tc="0.3",ci="verify-api",Ct="https://verify.walletconnect.com",bi="https://verify.walletconnect.org",Ac=[Ct,bi],Oc="echo",Mc="https://echo.walletconnect.com";class zc{constructor(e,t){this.core=e,this.logger=t,this.keychain=new Map,this.name=rc,this.version=nc,this.initialized=!1,this.storagePrefix=gt,this.init=async()=>{if(!this.initialized){const r=await this.getKeyChain();typeof r<"u"&&(this.keychain=r),this.initialized=!0}},this.has=r=>(this.isInitialized(),this.keychain.has(r)),this.set=async(r,s)=>{this.isInitialized(),this.keychain.set(r,s),await this.persist()},this.get=r=>{this.isInitialized();const s=this.keychain.get(r);if(typeof s>"u"){const{message:o}=j("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(o)}return s},this.del=async r=>{this.isInitialized(),this.keychain.delete(r),await this.persist()},this.core=e,this.logger=Je(t,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,Ss(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ps(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Cc{constructor(e,t,r){this.core=e,this.logger=t,this.name=ic,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=s=>(this.isInitialized(),this.keychain.has(s)),this.getClientId=async()=>{this.isInitialized();const s=await this.getClientSeed(),o=Gi(s);return Cs(o.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const s=Fr();return this.setPrivateKey(s.publicKey,s.privateKey)},this.signJWT=async s=>{this.isInitialized();const o=await this.getClientSeed(),c=Gi(o),u=fi();return await ya(u,s,sc,c)},this.generateSharedKey=(s,o,c)=>{this.isInitialized();const u=this.getPrivateKey(s),m=qr(u,o);return this.setSymKey(m,c)},this.setSymKey=async(s,o)=>{this.isInitialized();const c=o||Gr(s);return await this.keychain.set(c,s),c},this.deleteKeyPair=async s=>{this.isInitialized(),await this.keychain.del(s)},this.deleteSymKey=async s=>{this.isInitialized(),await this.keychain.del(s)},this.encode=async(s,o,c)=>{this.isInitialized();const u=Wr(c),m=Rt(o);if(Di(u)){const I=u.senderPublicKey,O=u.receiverPublicKey;s=await this.generateSharedKey(I,O)}const l=this.getSymKey(s),{type:g,senderPublicKey:w}=u;return Jr({type:g,symKey:l,message:m,senderPublicKey:w})},this.decode=async(s,o,c)=>{this.isInitialized();const u=Vr(o,c);if(Di(u)){const m=u.receiverPublicKey,l=u.senderPublicKey;s=await this.generateSharedKey(m,l)}try{const m=this.getSymKey(s),l=Yr({symKey:m,encoded:o});return Qt(l)}catch(m){this.logger.error(`Failed to decode message from topic: '${s}', clientId: '${await this.getClientId()}'`),this.logger.error(m)}},this.getPayloadType=s=>{const o=Ni(s);return Xr(o.type)},this.getPayloadSenderPublicKey=s=>{const o=Ni(s);return o.senderPublicKey?ei(o.senderPublicKey,Zr):void 0},this.core=e,this.logger=Je(t,this.name),this.keychain=r||new zc(this.core,this.logger)}get context(){return et(this.logger)}async setPrivateKey(e,t){return await this.keychain.set(e,t),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(is)}catch{e=fi(),await this.keychain.set(is,e)}return Zo(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Rc extends _n{constructor(e,t){super(e,t),this.logger=e,this.core=t,this.messages=new Map,this.name=ac,this.version=oc,this.initialized=!1,this.storagePrefix=gt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const r=await this.getRelayerMessages();typeof r<"u"&&(this.messages=r),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}finally{this.initialized=!0}}},this.set=async(r,s)=>{this.isInitialized();const o=di(s);let c=this.messages.get(r);return typeof c>"u"&&(c={}),typeof c[o]<"u"||(c[o]=s,this.messages.set(r,c),await this.persist()),o},this.get=r=>{this.isInitialized();let s=this.messages.get(r);return typeof s>"u"&&(s={}),s},this.has=(r,s)=>{this.isInitialized();const o=this.get(r),c=di(s);return typeof o[c]<"u"},this.del=async r=>{this.isInitialized(),this.messages.delete(r),await this.persist()},this.logger=Je(e,this.name),this.core=t}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,Ss(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?Ps(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Lc extends In{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.events=new pt.EventEmitter,this.name=hc,this.queue=new Map,this.publishTimeout=N.toMiliseconds(N.ONE_MINUTE),this.failedPublishTimeout=N.toMiliseconds(N.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(r,s,o)=>{var c;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:r,message:s,opts:o}});const u=(o==null?void 0:o.ttl)||cc,m=gi(o),l=(o==null?void 0:o.prompt)||!1,g=(o==null?void 0:o.tag)||0,w=(o==null?void 0:o.id)||ws().toString(),I={topic:r,message:s,opts:{ttl:u,relay:m,prompt:l,tag:g,id:w}},O=`Failed to publish payload, please try again. id:${w} tag:${g}`,_=Date.now();let C,$=1;try{for(;C===void 0;){if(Date.now()-_>this.publishTimeout)throw new Error(O);this.logger.trace({id:w,attempts:$},`publisher.publish - attempt ${$}`),C=await await It(this.rpcPublish(r,s,u,m,l,g,w).catch(K=>this.logger.warn(K)),this.publishTimeout,O),$++,C||await new Promise(K=>setTimeout(K,this.failedPublishTimeout))}this.relayer.events.emit(Qe.publish,I),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:w,topic:r,message:s,opts:o}})}catch(K){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(K),(c=o==null?void 0:o.internal)!=null&&c.throwOnFailedPublish)throw K;this.queue.set(w,I)}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.relayer=e,this.logger=Je(t,this.name),this.registerEventListeners()}get context(){return et(this.logger)}rpcPublish(e,t,r,s,o,c,u){var m,l,g,w;const I={method:zt(s.protocol).publish,params:{topic:e,message:t,ttl:r,prompt:o,tag:c},id:u};return li((m=I.params)==null?void 0:m.prompt)&&((l=I.params)==null||delete l.prompt),li((g=I.params)==null?void 0:g.tag)&&((w=I.params)==null||delete w.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:I}),this.relayer.request(I)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:t,message:r,opts:s}=e;await this.publish(t,r,s)})}registerEventListeners(){this.relayer.core.heartbeat.on(Dt.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(Qe.connection_stalled);return}this.checkQueue()}),this.relayer.on(Qe.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Dc{constructor(){this.map=new Map,this.set=(e,t)=>{const r=this.get(e);this.exists(e,t)||this.map.set(e,[...r,t])},this.get=e=>this.map.get(e)||[],this.exists=(e,t)=>this.get(e).includes(t),this.delete=(e,t)=>{if(typeof t>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const r=this.get(e);if(!this.exists(e,t))return;const s=r.filter(o=>o!==t);if(!s.length){this.map.delete(e);return}this.map.set(e,s)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var Nc=Object.defineProperty,Kc=Object.defineProperties,Uc=Object.getOwnPropertyDescriptors,rs=Object.getOwnPropertySymbols,$c=Object.prototype.hasOwnProperty,jc=Object.prototype.propertyIsEnumerable,ns=(n,e,t)=>e in n?Nc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Ot=(n,e)=>{for(var t in e||(e={}))$c.call(e,t)&&ns(n,t,e[t]);if(rs)for(var t of rs(e))jc.call(e,t)&&ns(n,t,e[t]);return n},hi=(n,e)=>Kc(n,Uc(e));class Hc extends En{constructor(e,t){super(e,t),this.relayer=e,this.logger=t,this.subscriptions=new Map,this.topicMap=new Dc,this.events=new pt.EventEmitter,this.name=wc,this.version=vc,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=gt,this.subscribeTimeout=N.toMiliseconds(N.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.pendingBatchMessages=[],this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}});try{const o=gi(s),c={topic:r,relay:o};this.pending.set(r,c);const u=await this.rpcSubscribe(r,o);return typeof u=="string"&&(this.onSubscribe(u,c),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:r,opts:s}})),u}catch(o){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(o),o}},this.unsubscribe=async(r,s)=>{await this.restartToComplete(),this.isInitialized(),typeof(s==null?void 0:s.id)<"u"?await this.unsubscribeById(r,s.id,s):await this.unsubscribeByTopic(r,s)},this.isSubscribed=async r=>{if(this.topics.includes(r))return!0;const s=`${this.pendingSubscriptionWatchLabel}_${r}`;return await new Promise((o,c)=>{const u=new N.Watch;u.start(s);const m=setInterval(()=>{!this.pending.has(r)&&this.topics.includes(r)&&(clearInterval(m),u.stop(s),o(!0)),u.elapsed(s)>=xc&&(clearInterval(m),u.stop(s),c(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Je(t,this.name),this.clientId=""}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,t){let r=!1;try{r=this.getSubscription(e).topic===t}catch{}return r}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,t){const r=this.topicMap.get(e);await Promise.all(r.map(async s=>await this.unsubscribeById(e,s,t)))}async unsubscribeById(e,t,r){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}});try{const s=gi(r);await this.rpcUnsubscribe(e,t,s);const o=Mt("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,t,o),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:t,opts:r}})}catch(s){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(s),s}}async rpcSubscribe(e,t){const r={method:zt(t.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await It(this.relayer.request(r).catch(s=>this.logger.warn(s)),this.subscribeTimeout)?di(e+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(Qe.connection_stalled)}return null}async rpcBatchSubscribe(e){if(!e.length)return;const t=e[0].relay,r={method:zt(t.protocol).batchSubscribe,params:{topics:e.map(s=>s.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});try{return await await It(this.relayer.request(r).catch(s=>this.logger.warn(s)),this.subscribeTimeout)}catch{this.relayer.events.emit(Qe.connection_stalled)}}async rpcBatchFetchMessages(e){if(!e.length)return;const t=e[0].relay,r={method:zt(t.protocol).batchFetchMessages,params:{topics:e.map(o=>o.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:r});let s;try{s=await await It(this.relayer.request(r).catch(o=>this.logger.warn(o)),this.subscribeTimeout)}catch{this.relayer.events.emit(Qe.connection_stalled)}return s}rpcUnsubscribe(e,t,r){const s={method:zt(r.protocol).unsubscribe,params:{topic:e,id:t}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),this.relayer.request(s)}onSubscribe(e,t){this.setSubscription(e,hi(Ot({},t),{id:e})),this.pending.delete(t.topic)}onBatchSubscribe(e){e.length&&e.forEach(t=>{this.setSubscription(t.id,Ot({},t)),this.pending.delete(t.topic)})}async onUnsubscribe(e,t,r){this.events.removeAllListeners(t),this.hasSubscription(t,e)&&this.deleteSubscription(t,r),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,t){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:t}),this.addSubscription(e,t)}addSubscription(e,t){this.subscriptions.set(e,Ot({},t)),this.topicMap.set(t.topic,e),this.events.emit(ot.created,t)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const t=this.subscriptions.get(e);if(!t){const{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}deleteSubscription(e,t){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:t});const r=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(r.topic,e),this.events.emit(ot.deleted,hi(Ot({},r),{reason:t}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(ot.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let t=0;t<e;t++){const r=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchFetchMessages(r),await this.batchSubscribe(r)}}this.events.emit(ot.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const t=await this.rpcBatchSubscribe(e);Sn(t)&&this.onBatchSubscribe(t.map((r,s)=>hi(Ot({},e[s]),{id:r})))}async batchFetchMessages(e){if(!e.length)return;this.logger.trace(`Fetching batch messages for ${e.length} subscriptions`);const t=await this.rpcBatchFetchMessages(e);t&&t.messages&&(this.pendingBatchMessages=this.pendingBatchMessages.concat(t.messages))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const e=[];this.pending.forEach(t=>{e.push(t)}),await this.batchSubscribe(e),this.pendingBatchMessages.length&&(await this.relayer.handleBatchMessageEvents(this.pendingBatchMessages),this.pendingBatchMessages=[])}registerEventListeners(){this.relayer.core.heartbeat.on(Dt.pulse,async()=>{await this.checkPending()}),this.events.on(ot.created,async e=>{const t=ot.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()}),this.events.on(ot.deleted,async e=>{const t=ot.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.restartInProgress||(clearInterval(t),e())},this.pollingInterval)})}}var Bc=Object.defineProperty,as=Object.getOwnPropertySymbols,kc=Object.prototype.hasOwnProperty,Fc=Object.prototype.propertyIsEnumerable,os=(n,e,t)=>e in n?Bc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,qc=(n,e)=>{for(var t in e||(e={}))kc.call(e,t)&&os(n,t,e[t]);if(as)for(var t of as(e))Fc.call(e,t)&&os(n,t,e[t]);return n};class Gc extends Qr{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new pt.EventEmitter,this.name=uc,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=N.toMiliseconds(N.THIRTY_SECONDS+N.ONE_SECOND),this.request=async t=>{var r,s;this.logger.debug("Publishing Request Payload");const o=t.id||ws().toString();await this.toEstablishConnection();try{const c=this.provider.request(t);this.requestsInFlight.set(o,{promise:c,request:t}),this.logger.trace({id:o,method:t.method,topic:(r=t.params)==null?void 0:r.topic},"relayer.request - attempt to publish...");const u=await new Promise(async(m,l)=>{const g=()=>{l(new Error(`relayer.request - publish interrupted, id: ${o}`))};this.provider.on(Ze.disconnect,g);const w=await c;this.provider.off(Ze.disconnect,g),m(w)});return this.logger.trace({id:o,method:t.method,topic:(s=t.params)==null?void 0:s.topic},"relayer.request - published"),u}catch(c){throw this.logger.debug(`Failed to Publish Request: ${o}`),c}finally{this.requestsInFlight.delete(o)}},this.resetPingTimeout=()=>{if(ui())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var t,r,s;(s=(r=(t=this.provider)==null?void 0:t.connection)==null?void 0:r.socket)==null||s.terminate()},this.heartBeatTimeout)}catch(t){this.logger.warn(t)}},this.onPayloadHandler=t=>{this.onProviderPayload(t),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(Qe.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=t=>{this.logger.error(t),this.events.emit(Qe.error,t),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Ze.payload,this.onPayloadHandler),this.provider.on(Ze.connect,this.onConnectHandler),this.provider.on(Ze.disconnect,this.onDisconnectHandler),this.provider.on(Ze.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Je(e.logger,this.name):en(bs({level:e.logger||fc})),this.messages=new Rc(this.logger,e.core),this.subscriber=new Hc(this,this.logger),this.publisher=new Lc(this,this.logger),this.relayUrl=(e==null?void 0:e.relayUrl)||Fs,this.projectId=e.projectId,this.bundleId=tn(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${ss}...`),await this.restartTransport(ss)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},yc)}get context(){return et(this.logger)}get connected(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===1}get connecting(){var e,t,r;return((r=(t=(e=this.provider)==null?void 0:e.connection)==null?void 0:t.socket)==null?void 0:r.readyState)===0}async publish(e,t,r){this.isInitialized(),await this.publisher.publish(e,t,r),await this.recordMessageEvent({topic:e,message:t,publishedAt:Date.now()})}async subscribe(e,t){var r;this.isInitialized();let s=((r=this.subscriber.topicMap.get(e))==null?void 0:r[0])||"",o;const c=u=>{u.topic===e&&(this.subscriber.off(ot.created,c),o())};return await Promise.all([new Promise(u=>{o=u,this.subscriber.on(ot.created,c)}),new Promise(async u=>{s=await this.subscriber.subscribe(e,t)||s,u()})]),s}async unsubscribe(e,t){this.isInitialized(),await this.subscriber.unsubscribe(e,t)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(e=>e.promise))}catch(e){this.logger.warn(e)}this.hasExperiencedNetworkDisruption||this.connected?await It(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect()),await this.createProvider(),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(t,r)=>{const s=()=>{this.provider.off(Ze.disconnect,s),r(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(Ze.disconnect,s),await It(this.provider.connect(),N.toMiliseconds(N.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(o=>{r(o)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,t()})}catch(t){this.logger.error(t);const r=t;if(this.hasExperiencedNetworkDisruption=!0,!this.isConnectionStalled(r.message))throw t}finally{this.connectionAttemptInProgress=!1}}async restartTransport(e){this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Ki())throw new Error("No internet connection detected. Please restart your network and try again.")}async handleBatchMessageEvents(e){if((e==null?void 0:e.length)===0){this.logger.trace("Batch message events is empty. Ignoring...");return}const t=e.sort((r,s)=>r.publishedAt-s.publishedAt);this.logger.trace(`Batch of ${t.length} message events sorted`);for(const r of t)try{await this.onMessageEvent(r)}catch(s){this.logger.warn(s)}this.logger.trace(`Batch of ${t.length} message events processed`)}startPingTimeout(){var e,t,r,s,o;if(ui())try{(t=(e=this.provider)==null?void 0:e.connection)!=null&&t.socket&&((o=(s=(r=this.provider)==null?void 0:r.connection)==null?void 0:s.socket)==null||o.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(c){this.logger.warn(c)}}isConnectionStalled(e){return this.staleConnectionErrors.some(t=>e.includes(t))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new sn(new va(rn({sdkVersion:pc,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:t,message:r}=e;await this.messages.set(t,r)}async shouldIgnoreMessageEvent(e){const{topic:t,message:r}=e;if(!r||r.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${r}`),!0;if(!await this.subscriber.isSubscribed(t))return this.logger.debug(`Ignoring message for non-subscribed topic ${t}`),!0;const s=this.messages.has(t,r);return s&&this.logger.debug(`Ignoring duplicate message: ${r}`),s}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),vs(e)){if(!e.method.endsWith(dc))return;const t=e.params,{topic:r,message:s,publishedAt:o}=t.data,c={topic:r,message:s,publishedAt:o};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(qc({type:"event",event:t.id},c)),this.events.emit(t.id,c),await this.acknowledgePayload(e),await this.onMessageEvent(c)}else xs(e)&&this.events.emit(Qe.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(Qe.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const t=_s(e.id,!0);await this.provider.connection.send(t)}unregisterProviderListeners(){this.provider.off(Ze.payload,this.onPayloadHandler),this.provider.off(Ze.connect,this.onConnectHandler),this.provider.off(Ze.disconnect,this.onDisconnectHandler),this.provider.off(Ze.error,this.onProviderErrorHandler),clearTimeout(this.pingTimeout)}async registerEventListeners(){let e=await Ki();nn(async t=>{e!==t&&(e=t,t?await this.restartTransport().catch(r=>this.logger.error(r)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.requestsInFlight.clear(),clearTimeout(this.pingTimeout),this.events.emit(Qe.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e))},N.toMiliseconds(gc))}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(e=>{const t=setInterval(()=>{this.connected&&(clearInterval(t),e())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var Wc=Object.defineProperty,cs=Object.getOwnPropertySymbols,Jc=Object.prototype.hasOwnProperty,Vc=Object.prototype.propertyIsEnumerable,hs=(n,e,t)=>e in n?Wc(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ls=(n,e)=>{for(var t in e||(e={}))Jc.call(e,t)&&hs(n,t,e[t]);if(cs)for(var t of cs(e))Vc.call(e,t)&&hs(n,t,e[t]);return n};class Yc extends $r{constructor(e,t,r,s=gt,o=void 0){super(e,t,r,s),this.core=e,this.logger=t,this.name=r,this.map=new Map,this.version=mc,this.cached=[],this.initialized=!1,this.storagePrefix=gt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(c=>{this.getKey&&c!==null&&!li(c)?this.map.set(this.getKey(c),c):jr(c)?this.map.set(c.id,c):Hr(c)&&this.map.set(c.topic,c)}),this.cached=[],this.initialized=!0)},this.set=async(c,u)=>{this.isInitialized(),this.map.has(c)?await this.update(c,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:c,value:u}),this.map.set(c,u),await this.persist())},this.get=c=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:c}),this.getData(c)),this.getAll=c=>(this.isInitialized(),c?this.values.filter(u=>Object.keys(c).every(m=>_a(u[m],c[m]))):this.values),this.update=async(c,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:c,update:u});const m=ls(ls({},this.getData(c)),u);this.map.set(c,m),await this.persist()},this.delete=async(c,u)=>{this.isInitialized(),this.map.has(c)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:c,reason:u}),this.map.delete(c),this.addToRecentlyDeleted(c),await this.persist())},this.logger=Je(t,this.name),this.storagePrefix=s,this.getKey=o}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const t=this.map.get(e);if(!t){if(this.recentlyDeleted.includes(e)){const{message:s}=j("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(s),new Error(s)}const{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(r),new Error(r)}return t}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Xc{constructor(e,t){this.core=e,this.logger=t,this.name=_c,this.version=Ic,this.events=new an,this.initialized=!1,this.storagePrefix=gt,this.ignoredPayloadTypes=[on],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:r})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...r])]},this.create=async r=>{this.isInitialized();const s=fi(),o=await this.core.crypto.setSymKey(s),c=Jt(N.FIVE_MINUTES),u={protocol:lc},m={topic:o,expiry:c,relay:u,active:!1},l=cn({protocol:this.core.protocol,version:this.core.version,topic:o,symKey:s,relay:u,expiryTimestamp:c,methods:r==null?void 0:r.methods});return this.core.expirer.set(o,c),await this.pairings.set(o,m),await this.core.relayer.subscribe(o),{topic:o,uri:l}},this.pair=async r=>{this.isInitialized(),this.isValidPair(r);const{topic:s,symKey:o,relay:c,expiryTimestamp:u,methods:m}=Ui(r.uri);let l;if(this.pairings.keys.includes(s)&&(l=this.pairings.get(s),l.active))throw new Error(`Pairing already exists: ${s}. Please try again with a new connection URI.`);const g=u||Jt(N.FIVE_MINUTES),w={topic:s,relay:c,expiry:g,active:!1,methods:m};return this.core.expirer.set(s,g),await this.pairings.set(s,w),r.activatePairing&&await this.activate({topic:s}),this.events.emit(Wt.create,w),this.core.crypto.keychain.has(s)||await this.core.crypto.setSymKey(o,s),await this.core.relayer.subscribe(s,{relay:c}),w},this.activate=async({topic:r})=>{this.isInitialized();const s=Jt(N.THIRTY_DAYS);this.core.expirer.set(r,s),await this.pairings.update(r,{active:!0,expiry:s})},this.ping=async r=>{this.isInitialized(),await this.isValidPing(r);const{topic:s}=r;if(this.pairings.keys.includes(s)){const o=await this.sendRequest(s,"wc_pairingPing",{}),{done:c,resolve:u,reject:m}=hn();this.events.once(si("pairing_ping",o),({error:l})=>{l?m(l):u()}),await c()}},this.updateExpiry=async({topic:r,expiry:s})=>{this.isInitialized(),await this.pairings.update(r,{expiry:s})},this.updateMetadata=async({topic:r,metadata:s})=>{this.isInitialized(),await this.pairings.update(r,{peerMetadata:s})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async r=>{this.isInitialized(),await this.isValidDisconnect(r);const{topic:s}=r;this.pairings.keys.includes(s)&&(await this.sendRequest(s,"wc_pairingDelete",Mt("USER_DISCONNECTED")),await this.deletePairing(s))},this.sendRequest=async(r,s,o)=>{const c=Es(s,o),u=await this.core.crypto.encode(r,c),m=At[s].req;return this.core.history.set(r,c),this.core.relayer.publish(r,u,m),c.id},this.sendResult=async(r,s,o)=>{const c=_s(r,o),u=await this.core.crypto.encode(s,c),m=await this.core.history.get(s,r),l=At[m.request.method].res;await this.core.relayer.publish(s,u,l),await this.core.history.resolve(c)},this.sendError=async(r,s,o)=>{const c=ys(r,o),u=await this.core.crypto.encode(s,c),m=await this.core.history.get(s,r),l=At[m.request.method]?At[m.request.method].res:At.unregistered_method.res;await this.core.relayer.publish(s,u,l),await this.core.history.resolve(c)},this.deletePairing=async(r,s)=>{await this.core.relayer.unsubscribe(r),await Promise.all([this.pairings.delete(r,Mt("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(r),s?Promise.resolve():this.core.expirer.del(r)])},this.cleanup=async()=>{const r=this.pairings.getAll().filter(s=>$i(s.expiry));await Promise.all(r.map(s=>this.deletePairing(s.topic)))},this.onRelayEventRequest=r=>{const{topic:s,payload:o}=r;switch(o.method){case"wc_pairingPing":return this.onPairingPingRequest(s,o);case"wc_pairingDelete":return this.onPairingDeleteRequest(s,o);default:return this.onUnknownRpcMethodRequest(s,o)}},this.onRelayEventResponse=async r=>{const{topic:s,payload:o}=r,c=(await this.core.history.get(s,o.id)).request.method;switch(c){case"wc_pairingPing":return this.onPairingPingResponse(s,o);default:return this.onUnknownRpcMethodResponse(c)}},this.onPairingPingRequest=async(r,s)=>{const{id:o}=s;try{this.isValidPing({topic:r}),await this.sendResult(o,r,!0),this.events.emit(Wt.ping,{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onPairingPingResponse=(r,s)=>{const{id:o}=s;setTimeout(()=>{ln(s)?this.events.emit(si("pairing_ping",o),{}):Is(s)&&this.events.emit(si("pairing_ping",o),{error:s.error})},500)},this.onPairingDeleteRequest=async(r,s)=>{const{id:o}=s;try{this.isValidDisconnect({topic:r}),await this.deletePairing(r),this.events.emit(Wt.delete,{id:o,topic:r})}catch(c){await this.sendError(o,r,c),this.logger.error(c)}},this.onUnknownRpcMethodRequest=async(r,s)=>{const{id:o,method:c}=s;try{if(this.registeredMethods.includes(c))return;const u=Mt("WC_METHOD_UNSUPPORTED",c);await this.sendError(o,r,u),this.logger.error(u)}catch(u){await this.sendError(o,r,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=r=>{this.registeredMethods.includes(r)||this.logger.error(Mt("WC_METHOD_UNSUPPORTED",r))},this.isValidPair=r=>{var s;if(!ri(r)){const{message:c}=j("MISSING_OR_INVALID",`pair() params: ${r}`);throw new Error(c)}if(!fn(r.uri)){const{message:c}=j("MISSING_OR_INVALID",`pair() uri: ${r.uri}`);throw new Error(c)}const o=Ui(r.uri);if(!((s=o==null?void 0:o.relay)!=null&&s.protocol)){const{message:c}=j("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(c)}if(!(o!=null&&o.symKey)){const{message:c}=j("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(c)}if(o!=null&&o.expiryTimestamp&&N.toMiliseconds(o==null?void 0:o.expiryTimestamp)<Date.now()){const{message:c}=j("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(c)}},this.isValidPing=async r=>{if(!ri(r)){const{message:o}=j("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidDisconnect=async r=>{if(!ri(r)){const{message:o}=j("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(o)}const{topic:s}=r;await this.isValidPairingTopic(s)},this.isValidPairingTopic=async r=>{if(!un(r,!1)){const{message:s}=j("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(s)}if(!this.pairings.keys.includes(r)){const{message:s}=j("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(s)}if($i(this.pairings.get(r).expiry)){await this.deletePairing(r);const{message:s}=j("EXPIRED",`pairing topic: ${r}`);throw new Error(s)}},this.core=e,this.logger=Je(t,this.name),this.pairings=new Yc(this.core,this.logger,this.name,this.storagePrefix)}get context(){return et(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(Qe.message,async e=>{const{topic:t,message:r}=e;if(!this.pairings.keys.includes(t)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(r)))return;const s=await this.core.crypto.decode(t,r);try{vs(s)?(this.core.history.set(t,s),this.onRelayEventRequest({topic:t,payload:s})):xs(s)&&(await this.core.history.resolve(s),await this.onRelayEventResponse({topic:t,payload:s}),this.core.history.delete(t,s.id))}catch(o){this.logger.error(o)}})}registerExpirerEvents(){this.core.expirer.on(nt.expired,async e=>{const{topic:t}=dn(e.target);t&&this.pairings.keys.includes(t)&&(await this.deletePairing(t,!0),this.events.emit(Wt.expire,{topic:t}))})}}class Zc extends gn{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.records=new Map,this.events=new pt.EventEmitter,this.name=Ec,this.version=Sc,this.cached=[],this.initialized=!1,this.storagePrefix=gt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.records.set(r.id,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(r,s,o)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:r,request:s,chainId:o}),this.records.has(s.id))return;const c={id:s.id,topic:r,request:{method:s.method,params:s.params||null},chainId:o,expiry:Jt(N.THIRTY_DAYS)};this.records.set(c.id,c),this.persist(),this.events.emit(rt.created,c)},this.resolve=async r=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:r}),!this.records.has(r.id))return;const s=await this.getRecord(r.id);typeof s.response>"u"&&(s.response=Is(r)?{error:r.error}:{result:r.result},this.records.set(s.id,s),this.persist(),this.events.emit(rt.updated,s))},this.get=async(r,s)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:r,id:s}),await this.getRecord(s)),this.delete=(r,s)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:s}),this.values.forEach(o=>{if(o.topic===r){if(typeof s<"u"&&o.id!==s)return;this.records.delete(o.id),this.events.emit(rt.deleted,o)}}),this.persist()},this.exists=async(r,s)=>(this.isInitialized(),this.records.has(s)?(await this.getRecord(s)).topic===r:!1),this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Je(t,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(typeof t.response<"u")return;const r={topic:t.topic,request:Es(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(r)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const t=this.records.get(e);if(!t){const{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(r)}return t}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(rt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(rt.created,e=>{const t=rt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(rt.updated,e=>{const t=rt.updated;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.events.on(rt.deleted,e=>{const t=rt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,record:e})}),this.core.heartbeat.on(Dt.pulse,()=>{this.cleanup()})}cleanup(){try{this.isInitialized();let e=!1;this.records.forEach(t=>{N.toMiliseconds(t.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${t.id}`),this.records.delete(t.id),this.events.emit(rt.deleted,t,!1),e=!0)}),e&&this.persist()}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Qc extends pn{constructor(e,t){super(e,t),this.core=e,this.logger=t,this.expirations=new Map,this.events=new pt.EventEmitter,this.name=Pc,this.version=Tc,this.cached=[],this.initialized=!1,this.storagePrefix=gt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(r=>this.expirations.set(r.target,r)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=r=>{try{const s=this.formatTarget(r);return typeof this.getExpiration(s)<"u"}catch{return!1}},this.set=(r,s)=>{this.isInitialized();const o=this.formatTarget(r),c={target:o,expiry:s};this.expirations.set(o,c),this.checkExpiry(o,c),this.events.emit(nt.created,{target:o,expiration:c})},this.get=r=>{this.isInitialized();const s=this.formatTarget(r);return this.getExpiration(s)},this.del=r=>{if(this.isInitialized(),this.has(r)){const s=this.formatTarget(r),o=this.getExpiration(s);this.expirations.delete(s),this.events.emit(nt.deleted,{target:s,expiration:o})}},this.on=(r,s)=>{this.events.on(r,s)},this.once=(r,s)=>{this.events.once(r,s)},this.off=(r,s)=>{this.events.off(r,s)},this.removeListener=(r,s)=>{this.events.removeListener(r,s)},this.logger=Je(t,this.name)}get context(){return et(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return yn(e);if(typeof e=="number")return mn(e);const{message:t}=j("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(t)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(nt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:t}=j("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(t),new Error(t)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const t=this.expirations.get(e);if(!t){const{message:r}=j("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(r),new Error(r)}return t}checkExpiry(e,t){const{expiry:r}=t;N.toMiliseconds(r)-Date.now()<=0&&this.expire(e,t)}expire(e,t){this.expirations.delete(e),this.events.emit(nt.expired,{target:e,expiration:t})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,t)=>this.checkExpiry(t,e))}registerEventListeners(){this.core.heartbeat.on(Dt.pulse,()=>this.checkExpirations()),this.events.on(nt.created,e=>{const t=nt.created;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(nt.expired,e=>{const t=nt.expired;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(nt.deleted,e=>{const t=nt.deleted;this.logger.info(`Emitting ${t}`),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=j("NOT_INITIALIZED",this.name);throw new Error(e)}}}class eh extends bn{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.name=ci,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async r=>{if(this.verifyDisabled||wn()||!vn())return;const s=this.getVerifyUrl(r==null?void 0:r.verifyUrl);this.verifyUrl!==s&&this.removeIframe(),this.verifyUrl=s;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o)}if(!this.initialized){this.removeIframe(),this.verifyUrl=bi;try{await this.createIframe()}catch(o){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(o),this.verifyDisabled=!0}}},this.register=async r=>{this.initialized?this.sendPost(r.attestationId):(this.addToQueue(r.attestationId),await this.init())},this.resolve=async r=>{if(this.isDevEnv)return"";const s=this.getVerifyUrl(r==null?void 0:r.verifyUrl);let o;try{o=await this.fetchAttestation(r.attestationId,s)}catch(c){this.logger.info(`failed to resolve attestation: ${r.attestationId} from url: ${s}`),this.logger.info(c),o=await this.fetchAttestation(r.attestationId,bi)}return o},this.fetchAttestation=async(r,s)=>{this.logger.info(`resolving attestation: ${r} from url: ${s}`);const o=this.startAbortTimer(N.ONE_SECOND*2),c=await fetch(`${s}/attestation/${r}`,{signal:this.abortController.signal});return clearTimeout(o),c.status===200?await c.json():void 0},this.addToQueue=r=>{this.queue.push(r)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(r=>this.sendPost(r)),this.queue=[])},this.sendPost=r=>{var s;try{if(!this.iframe)return;(s=this.iframe.contentWindow)==null||s.postMessage(r,"*"),this.logger.info(`postMessage sent: ${r} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let r;const s=o=>{o.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",s),r())};await Promise.race([new Promise(o=>{const c=document.getElementById(ci);if(c)return this.iframe=c,this.onInit(),o();window.addEventListener("message",s);const u=document.createElement("iframe");u.id=ci,u.src=`${this.verifyUrl}/${this.projectId}`,u.style.display="none",document.body.append(u),this.iframe=u,r=o}),new Promise((o,c)=>setTimeout(()=>{window.removeEventListener("message",s),c("verify iframe load timeout")},N.toMiliseconds(N.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=r=>{let s=r||Ct;return Ac.includes(s)||(this.logger.info(`verify url: ${s}, not included in trusted list, assigning default: ${Ct}`),s=Ct),s},this.logger=Je(t,this.name),this.verifyUrl=Ct,this.abortController=new AbortController,this.isDevEnv=ui()&&Ta.IS_VITEST}get context(){return et(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),N.toMiliseconds(e))}}class th extends xn{constructor(e,t){super(e,t),this.projectId=e,this.logger=t,this.context=Oc,this.registerDeviceToken=async r=>{const{clientId:s,token:o,notificationType:c,enableEncrypted:u=!1}=r,m=`${Mc}/${this.projectId}/clients`;await Pa(m,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,type:c,token:o,always_raw:u})})},this.logger=Je(t,this.context)}}var ih=Object.defineProperty,fs=Object.getOwnPropertySymbols,sh=Object.prototype.hasOwnProperty,rh=Object.prototype.propertyIsEnumerable,us=(n,e,t)=>e in n?ih(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,ds=(n,e)=>{for(var t in e||(e={}))sh.call(e,t)&&us(n,t,e[t]);if(fs)for(var t of fs(e))rh.call(e,t)&&us(n,t,e[t]);return n};class Ii extends Br{constructor(e){var t;super(e),this.protocol=ks,this.version=Qo,this.name=_i,this.events=new pt.EventEmitter,this.initialized=!1,this.on=(c,u)=>this.events.on(c,u),this.once=(c,u)=>this.events.once(c,u),this.off=(c,u)=>this.events.off(c,u),this.removeListener=(c,u)=>this.events.removeListener(c,u),this.projectId=e==null?void 0:e.projectId,this.relayUrl=(e==null?void 0:e.relayUrl)||Fs,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=bs({level:typeof(e==null?void 0:e.logger)=="string"&&e.logger?e.logger:ec.logger}),{logger:s,chunkLoggerController:o}=kr({opts:r,maxSizeInBytes:e==null?void 0:e.maxLogBlobSizeInBytes,loggerOverride:e==null?void 0:e.logger});this.logChunkController=o,(t=this.logChunkController)!=null&&t.downloadLogsBlobInBrowser&&(window.downloadLogsBlobInBrowser=async()=>{var c,u;(c=this.logChunkController)!=null&&c.downloadLogsBlobInBrowser&&((u=this.logChunkController)==null||u.downloadLogsBlobInBrowser({clientId:await this.crypto.getClientId()}))}),this.logger=Je(s,this.name),this.heartbeat=new vi,this.crypto=new Cc(this,this.logger,e==null?void 0:e.keychain),this.history=new Zc(this,this.logger),this.expirer=new Qc(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new ta(ds(ds({},tc),e==null?void 0:e.storageOptions)),this.relayer=new Gc({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new Xc(this,this.logger),this.verify=new eh(this.projectId||"",this.logger),this.echoClient=new th(this.projectId||"",this.logger)}static async init(e){const t=new Ii(e);await t.initialize();const r=await t.crypto.getClientId();return await t.storage.setItem(bc,r),t}get context(){return et(this.logger)}async start(){this.initialized||await this.initialize()}async getLogsBlob(){var e;return(e=this.logChunkController)==null?void 0:e.logsToBlob({clientId:await this.crypto.getClientId()})}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const ch=Ii;export{ch as B,nt as C,Yc as K,Ct as M,lc as c,Qe as f,Wt as q};
