import{aH as e,aI as T,aJ as z,aK as Q,aE as u,aL as C,aM as y,aN as M,aO as V,aP as $,aQ as P,aR as K,aS as Y,aT as R,aU as J,aV as H,aW as _,aX as G,aY as W,aZ as U,aC as S,a_ as X,a$ as Z,b0 as ee,b1 as B,b2 as te,b3 as se}from"./react-Dwep-vzK.js";import{u as g,a as L,b as ne,c as oe,w as ae,i as ce,d as re,e as ie,f as le,W as de}from"./web3-EJgd6xKM.js";import"./walletconnect--eljJOv5.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function r(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=r(o);fetch(o.href,a)}})();const k=({eth:t})=>e.jsx("div",{children:e.jsx("img",{src:`https://effigy.im/a/${t}.svg`,alt:"Profile picture",className:"profilePic"})});function ue(){const{address:t}=g();return e.jsx("div",{className:"ChatSidebar",children:e.jsx("div",{className:"profilePicture",children:t&&e.jsx(k,{eth:t})})})}const he={apiKey:"AIzaSyBRDBbrJbmLwb3YTI_YBmMdTjLEd8KjS2E",authDomain:"tokenchat-b8673.firebaseapp.com",projectId:"tokenchat-b8673",storageBucket:"tokenchat-b8673.appspot.com",messagingSenderId:"593980787293",appId:"1:593980787293:web:7c58ff7656a3fa31b19bb4",measurementId:"G-RB9WJLVQC0"},D=T(he);z(D);const v=Q(D);function me({setSelectedChatId:t,users:s,getWalletById:r}){const{address:n}=g(),[o,a]=u.useState([]),[d,m]=u.useState(null);u.useEffect(()=>{if(!n)return;(async()=>{try{const h=C(v,"privateChats"),F=(await y(h)).docs.map(I=>{const q=I.data();return{id:I.id,pid:q.pid||[]}});a(F)}catch(h){m("Failed to fetch data. Please check your internet connection."),console.error("Fetch error:",h)}})()},[n]);const i=s.find(l=>l.wallet===n),c=i?o.filter(l=>l.pid.includes(i.id)):[],f=l=>{const h=s.find(E=>E.id===l);return h?h.name:l},x=l=>i&&l.find(h=>h!==i.id)||"",p=l=>{const h=x(l);return f(h)},j=l=>{t(l)};return e.jsxs("div",{className:"chatSelector",children:[d&&e.jsx("p",{className:"error",children:d}),c.length>0?c.map(l=>e.jsxs("div",{className:"contactBox",onClick:()=>j(l.id),children:[e.jsx(k,{eth:r(x(l.pid))}),e.jsxs("div",{className:"contactTextBox",children:[e.jsx("h3",{children:p(l.pid)}),e.jsx("h3",{children:"latest message"})]})]},l.id)):e.jsx("p",{children:"No chatrooms available"})]})}const A=u.createContext(void 0),fe=({children:t})=>{const[s,r]=u.useState(void 0);return e.jsx(A.Provider,{value:{currentUser:s,setCurrentUser:r},children:t})},N=()=>{const t=u.useContext(A);if(!t)throw new Error("useUser must be used within a UserProvider");return t},pe=async(t,s,r)=>{try{const n=C(v,"privateChats",r,"msg");await $(n,{txt:t,from:s,ts:new Date}),console.log("Message sent successfully")}catch(n){console.error("Error sending message:",n)}},ge=({selectedChatId:t})=>{const[s,r]=M.useState(""),{currentUser:n}=N(),o=d=>{r(d.target.value)},a=()=>{if(!t||!n||!s.trim()){console.error("Missing required data:",{selectedChatId:t,currentUser:n,inputValue:s});return}pe(s,n.id,t),r("")};return e.jsxs("div",{className:"chatBottomBar",children:[e.jsx("input",{type:"text",className:"messageInput",placeholder:"Type your message",value:s,onChange:o}),e.jsx("button",{className:"sendMessageButton",onClick:a,disabled:!t||!n,title:"Send message",children:e.jsx(V,{size:20})})]})};function xe({children:t,selectedChatId:s}){return e.jsxs("div",{className:"chatWindow",children:[e.jsx("div",{className:"chatContent",children:t})," ",e.jsx(ge,{selectedChatId:s})]})}const je=({text:t,timeStamp:s,from:r,own:n})=>e.jsx("div",{className:"messageBox",children:e.jsxs("div",{className:`message ${n?"own":""}`,children:[e.jsx("p",{className:"message-text",children:t}),e.jsx("p",{className:"message-timestamp",children:new Date(s).toLocaleString()})]})});function Ce({selectedChatId:t,users:s,getWalletById:r}){const[n,o]=u.useState([]),{address:a}=g(),{currentUser:d}=N(),m=u.useRef(null),i=()=>{var c;(c=m.current)==null||c.scrollIntoView({behavior:"smooth"})};return u.useEffect(()=>{i()},[n]),u.useEffect(()=>{if(!t)return;const c=C(v,"privateChats",t,"msg"),f=P(c,K("ts","asc")),x=Y(f,p=>{const j=[];p.forEach(l=>{const h=l.data();h.txt&&h.ts&&h.from?j.push(h):console.log("Missing fields in document:",l.id)}),console.log("Real-time Messages Update:",j),o(j)},p=>{console.error("Error fetching messages:",p)});return()=>x()},[t]),e.jsxs("div",{className:"chatContent",children:[n.map((c,f)=>{const x=d!=null&&d.id?c.from===d.id:!1;return e.jsx(je,{text:c.txt,timeStamp:c.ts.toMillis(),from:c.from,own:x},f)}),e.jsx("div",{ref:m})," "]})}function ve(){const{address:t}=g(),[s,r]=u.useState(null),[n,o]=u.useState([]),{setCurrentUser:a}=N();u.useEffect(()=>{(async()=>{const c=C(v,"users"),x=(await y(c)).docs.map(p=>({id:p.id,name:p.data().name,wallet:p.data().wallet}));o(x)})()},[]),u.useEffect(()=>{if(n.length>0&&t){const i=n.find(c=>c.wallet===t);console.log("Current User:",i),a(i)}},[n,t,a]);const d=i=>{r(i)},m=i=>{const c=n.find(f=>f.id===i);return c?c.wallet:""};return e.jsxs("div",{className:"chat",children:[e.jsx(ue,{}),e.jsx(me,{setSelectedChatId:d,users:n,getWalletById:m}),e.jsx(xe,{selectedChatId:s||void 0,children:s&&e.jsx(Ce,{selectedChatId:s,users:n,getWalletById:m})})]})}function we(){const{address:t}=g(),[s,r]=u.useState(null),n=R(),o=async a=>{const d=C(v,"users"),m=P(d,H("wallet","==",a));try{const c=!(await y(m)).empty;console.log("User found:",c),r(c),n(c?"/chat":"/signup")}catch(i){console.error("Error checking user:",i),r(!1),n("/signup")}};return e.jsxs("div",{children:[e.jsxs("button",{className:"proceedButton",onClick:()=>{t?o(t):console.error("Address is undefined")},children:[e.jsx(J,{size:28}),e.jsx("span",{children:"Proceed"})]}),s!==null&&e.jsx("p",{children:s?"User exists":"User does not exist"})]})}function be(){const{address:t,isConnected:s}=g(),{disconnect:r}=L(),n=async()=>{localStorage.removeItem("walletconnect"),localStorage.removeItem("walletConnected"),localStorage.removeItem("connectorId"),r()};return e.jsx("div",{className:"wallet-button",children:s&&t?e.jsxs("div",{className:"walletBubble",children:[e.jsxs("div",{className:"address",children:[t.slice(0,6),"...",t.slice(-4)]}),e.jsx("button",{onClick:n,children:e.jsx(_,{size:25})})]}):e.jsx("w3m-connect-button",{})})}function ye(){const{address:t,isConnected:s,connector:r}=g(),{connect:n,connectors:o}=ne();L();const[a,d]=u.useState(s);return R(),u.useEffect(()=>{if(localStorage.getItem("walletConnected")==="true"&&!s){console.log("Attempting to reconnect wallet automatically...");const i=localStorage.getItem("connectorId");if(console.log("Last used connector:",i),i){const c=o.find(f=>f.id===i);c&&(console.log("Reconnecting with saved connector:",i),n({connector:c}))}else{const c=o.find(f=>f.id==="injected");c&&(console.log("No saved connector, trying injected..."),n({connector:c}))}}},[n,o,s]),u.useEffect(()=>{console.log("Connection state changed:",s?"connected":"disconnected"),console.log("Current connector:",r==null?void 0:r.id),d(s),s&&!a&&console.log("Wallet newly connected:",t),!s&&a&&console.log("Wallet disconnected")},[s,t,a,r]),u.useEffect(()=>{const m=()=>{a&&!s&&(console.log("Connection lost while page was inactive, updating UI"),d(!1))};return window.addEventListener("focus",m),()=>{window.removeEventListener("focus",m)}},[a,s]),e.jsxs("div",{className:"homepage",children:[e.jsxs("div",{className:"title",children:[e.jsx("h1",{children:"Chat 3.0 is here."}),e.jsx("h2",{children:"Your personal web3 companion."})]}),e.jsx("div",{children:e.jsxs("div",{className:"login",children:[e.jsx("h3",{children:a?`Connected ${r!=null&&r.id?`(${r.id})`:""}`:"Connect your wallet"}),e.jsx(be,{}),a&&e.jsx(we,{})]})})]})}const Se=new G,b="02ee764d5cc25cff6387d6d3f7943fd6",w={name:"TokenChat",description:"Web3 Chat Application",url:"https://c4ctus96.github.io/tokenchat",icons:["https://avatars.githubusercontent.com/u/37784886"]},Ne=[S,W],O=oe({chains:Ne,transports:{[S.id]:U("https://eth-mainnet.g.alchemy.com/v2/demo"),[W.id]:U("https://arb-mainnet.g.alchemy.com/v2/demo")},connectors:[ae({projectId:b,metadata:w,showQrModal:!1}),ce({shimDisconnect:!0}),re({appName:w.name,appLogoUrl:w.icons[0]}),ie({options:{projectId:b},socials:["google","x","github","discord","apple"],showWallets:!0,email:!0,walletFeatures:!1})]});le({wagmiConfig:O,projectId:b,defaultChain:S,themeMode:"dark",enableAnalytics:!0,enableOnramp:!1,themeVariables:{"--w3m-accent":"#50b458","--w3m-color-mix":"#210059","--w3m-color-mix-strength":30}});function Ee({children:t}){const{isConnected:s}=g();return s?e.jsx(e.Fragment,{children:t}):e.jsx(te,{to:"/"})}function Ie(){const{isConnected:t}=g();return u.useEffect(()=>{console.log("App initialized, connection status:",t),typeof window.ethereum>"u"&&console.log("MetaMask not detected, but WalletConnect can still be used")},[t]),null}function Ue(){return e.jsx(de,{config:O,children:e.jsx(X,{client:Se,children:e.jsx(fe,{children:e.jsxs(Z,{basename:"/tokenchat",children:[e.jsx(Ie,{}),e.jsxs(ee,{children:[e.jsx(B,{path:"/",element:e.jsx(ye,{})}),e.jsx(B,{path:"/chat",element:e.jsx(Ee,{children:e.jsx(ve,{})})})]})]})})})})}const Be=document.getElementById("root"),Me=se(Be);Me.render(e.jsx(M.StrictMode,{children:e.jsx(Ue,{})}));
//# sourceMappingURL=index-C_1Xmm5r.js.map
