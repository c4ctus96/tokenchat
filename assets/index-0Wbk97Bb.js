import{aH as e,aI as Q,aJ as V,aK as $,aE as l,aL as j,aM as w,aN as P,aO as K,aP as R,aQ as N,aR as W,aS as Y,aT as D,aU as J,aV as H,aW as _,aX as G,aY as X,aZ as L,a_ as M,aC as E,a$ as Z,b0 as ee,b1 as te,b2 as y,b3 as se,b4 as ne}from"./react-DvB1B-f3.js";import{u as g,a as k,b as oe,c as ae,w as ce,i as re,d as ie,e as le,f as de,W as ue}from"./web3-DKmkEmjZ.js";import"./walletconnect-CjcQPAoj.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&n(d)}).observe(document,{childList:!0,subtree:!0});function c(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=c(a);fetch(a.href,o)}})();const A=({eth:t})=>e.jsx("div",{children:e.jsx("img",{src:`https://effigy.im/a/${t}.svg`,alt:"Profile picture",className:"profilePic"})});function he(){const{address:t}=g();return e.jsx("div",{className:"ChatSidebar",children:e.jsx("div",{className:"profilePicture",children:t&&e.jsx(A,{eth:t})})})}const me={apiKey:"AIzaSyBRDBbrJbmLwb3YTI_YBmMdTjLEd8KjS2E",authDomain:"tokenchat-b8673.firebaseapp.com",projectId:"tokenchat-b8673",storageBucket:"tokenchat-b8673.appspot.com",messagingSenderId:"593980787293",appId:"1:593980787293:web:7c58ff7656a3fa31b19bb4",measurementId:"G-RB9WJLVQC0"},O=Q(me);V(O);const C=$(O);function fe({setSelectedChatId:t,users:s,getWalletById:c}){const{address:n}=g(),[a,o]=l.useState([]),[d,h]=l.useState(null);l.useEffect(()=>{if(!n)return;(async()=>{try{const f=j(C,"privateChats"),T=(await w(f)).docs.map(U=>{const z=U.data();return{id:U.id,pid:z.pid||[]}});o(T)}catch(f){h("Failed to fetch data. Please check your internet connection."),console.error("Fetch error:",f)}})()},[n]);const i=s.find(u=>u.wallet===n),r=i?a.filter(u=>u.pid.includes(i.id)):[],m=u=>{const f=s.find(B=>B.id===u);return f?f.name:u},p=u=>i&&u.find(f=>f!==i.id)||"",x=u=>{const f=p(u);return m(f)},v=u=>{t(u)};return e.jsxs("div",{className:"chatSelector",children:[d&&e.jsx("p",{className:"error",children:d}),r.length>0?r.map(u=>e.jsxs("div",{className:"contactBox",onClick:()=>v(u.id),children:[e.jsx(A,{eth:c(p(u.pid))}),e.jsxs("div",{className:"contactTextBox",children:[e.jsx("h3",{children:x(u.pid)}),e.jsx("h3",{children:"latest message"})]})]},u.id)):e.jsx("p",{children:"No chatrooms available"})]})}const q=l.createContext(void 0),pe=({children:t})=>{const[s,c]=l.useState(void 0);return e.jsx(q.Provider,{value:{currentUser:s,setCurrentUser:c},children:t})},I=()=>{const t=l.useContext(q);if(!t)throw new Error("useUser must be used within a UserProvider");return t},ge=async(t,s,c)=>{try{const n=j(C,"privateChats",c,"msg");await R(n,{txt:t,from:s,ts:new Date}),console.log("Message sent successfully")}catch(n){console.error("Error sending message:",n)}},xe=({selectedChatId:t})=>{const[s,c]=P.useState(""),{currentUser:n}=I(),a=d=>{c(d.target.value)},o=()=>{if(!t||!n||!s.trim()){console.error("Missing required data:",{selectedChatId:t,currentUser:n,inputValue:s});return}ge(s,n.id,t),c("")};return e.jsxs("div",{className:"chatBottomBar",children:[e.jsx("input",{type:"text",className:"messageInput",placeholder:"Type your message",value:s,onChange:a}),e.jsx("button",{className:"sendMessageButton",onClick:o,disabled:!t||!n,title:"Send message",children:e.jsx(K,{size:20})})]})};function je({children:t,selectedChatId:s}){return e.jsxs("div",{className:"chatWindow",children:[e.jsx("div",{className:"chatContent",children:t})," ",e.jsx(xe,{selectedChatId:s})]})}const Ce=({text:t,timeStamp:s,from:c,own:n})=>e.jsx("div",{className:"messageBox",children:e.jsxs("div",{className:`message ${n?"own":""}`,children:[e.jsx("p",{className:"message-text",children:t}),e.jsx("p",{className:"message-timestamp",children:new Date(s).toLocaleString()})]})});function ve({selectedChatId:t,users:s,getWalletById:c}){const[n,a]=l.useState([]),{address:o}=g(),{currentUser:d}=I(),h=l.useRef(null),i=()=>{var r;(r=h.current)==null||r.scrollIntoView({behavior:"smooth"})};return l.useEffect(()=>{i()},[n]),l.useEffect(()=>{if(!t)return;const r=j(C,"privateChats",t,"msg"),m=N(r,W("ts","asc")),p=Y(m,x=>{const v=[];x.forEach(u=>{const f=u.data();f.txt&&f.ts&&f.from?v.push(f):console.log("Missing fields in document:",u.id)}),console.log("Real-time Messages Update:",v),a(v)},x=>{console.error("Error fetching messages:",x)});return()=>p()},[t]),e.jsxs("div",{className:"chatContent",children:[n.map((r,m)=>{const p=d!=null&&d.id?r.from===d.id:!1;return e.jsx(Ce,{text:r.txt,timeStamp:r.ts.toMillis(),from:r.from,own:p},m)}),e.jsx("div",{ref:h})," "]})}function we(){const{address:t}=g(),[s,c]=l.useState(null),[n,a]=l.useState([]),{setCurrentUser:o}=I();l.useEffect(()=>{(async()=>{const r=j(C,"users"),p=(await w(r)).docs.map(x=>({id:x.id,name:x.data().name,wallet:x.data().wallet}));a(p)})()},[]),l.useEffect(()=>{if(n.length>0&&t){const i=n.find(r=>r.wallet===t);console.log("Current User:",i),o(i)}},[n,t,o]);const d=i=>{c(i)},h=i=>{const r=n.find(m=>m.id===i);return r?r.wallet:""};return e.jsxs("div",{className:"chat",children:[e.jsx(he,{}),e.jsx(fe,{setSelectedChatId:d,users:n,getWalletById:h}),e.jsx(je,{selectedChatId:s||void 0,children:s&&e.jsx(ve,{selectedChatId:s,users:n,getWalletById:h})})]})}function ye(){const{address:t}=g(),[s,c]=l.useState(null),n=D(),a=async o=>{const d=j(C,"users"),h=N(d,H("wallet","==",o));try{const r=!(await w(h)).empty;console.log("User found:",r),c(r),n(r?"/chat":"/signup")}catch(i){console.error("Error checking user:",i),c(!1),n("/signup")}};return e.jsxs("div",{children:[e.jsxs("button",{className:"proceedButton",onClick:()=>{t?a(t):console.error("Address is undefined")},children:[e.jsx(J,{size:28}),e.jsx("span",{children:"Proceed"})]}),s!==null&&e.jsx("p",{children:s?"User exists":"User does not exist"})]})}function be(){const{address:t,isConnected:s}=g(),{disconnect:c}=k(),n=async()=>{localStorage.removeItem("walletconnect"),localStorage.removeItem("walletConnected"),localStorage.removeItem("connectorId"),c()};return e.jsx("div",{className:"wallet-button",children:s&&t?e.jsxs("div",{className:"walletBubble",children:[e.jsxs("div",{className:"address",children:[t.slice(0,6),"...",t.slice(-4)]}),e.jsx("button",{onClick:n,children:e.jsx(_,{size:25})})]}):e.jsx("w3m-connect-button",{})})}function Se(){const{address:t,isConnected:s,connector:c}=g(),{connect:n,connectors:a}=oe();k();const[o,d]=l.useState(s);return D(),l.useEffect(()=>{if(localStorage.getItem("walletConnected")==="true"&&!s){console.log("Attempting to reconnect wallet automatically...");const i=localStorage.getItem("connectorId");if(console.log("Last used connector:",i),i){const r=a.find(m=>m.id===i);r&&(console.log("Reconnecting with saved connector:",i),n({connector:r}))}else{const r=a.find(m=>m.id==="injected");r&&(console.log("No saved connector, trying injected..."),n({connector:r}))}}},[n,a,s]),l.useEffect(()=>{console.log("Connection state changed:",s?"connected":"disconnected"),console.log("Current connector:",c==null?void 0:c.id),d(s),s&&!o&&console.log("Wallet newly connected:",t),!s&&o&&console.log("Wallet disconnected")},[s,t,o,c]),l.useEffect(()=>{const h=()=>{o&&!s&&(console.log("Connection lost while page was inactive, updating UI"),d(!1))};return window.addEventListener("focus",h),()=>{window.removeEventListener("focus",h)}},[o,s]),e.jsxs("div",{className:"homepage",children:[e.jsxs("div",{className:"title",children:[e.jsx("h1",{children:"Chat 3.0 is here."}),e.jsx("h2",{children:"Your personal web3 companion."})]}),e.jsx("div",{children:e.jsxs("div",{className:"login",children:[e.jsx("h3",{children:o?`Connected ${c!=null&&c.id?`(${c.id})`:""}`:"Connect your wallet"}),e.jsx(be,{}),o&&e.jsx(ye,{})]})})]})}function Ne(){const{address:t}=g(),[s,c]=l.useState(""),[n,a]=l.useState(null),o=async()=>{const h=j(C,"users"),i=N(h,W("name"),G(10)),m=(await w(i)).docs.map(p=>({id:p.id,...p.data()}));a({users:m}),console.log("Fetched data:",m)};l.useEffect(()=>{o()},[]);const d=async()=>{console.log("Writing data:",t,s);try{await R(j(C,"users"),{wallet:t,name:s}),console.log("Data written successfully"),o()}catch(h){console.error("Error writing data:",h)}};return e.jsxs("div",{className:"centered-signup",children:[e.jsxs("div",{className:"welcomeText",children:[e.jsx("h1",{children:"Welcome to Chat 3.0"}),e.jsx("h2",{children:"One last step to start chatting"})]}),e.jsxs("p",{children:["Wallet Address: ",t]}),e.jsxs("div",{className:"signupBox",children:[e.jsx("input",{type:"text",placeholder:"Enter name",value:s,onChange:h=>c(h.target.value)}),e.jsx("button",{onClick:d,children:"Register"})]})]})}const Ee=new X,S="02ee764d5cc25cff6387d6d3f7943fd6",b={name:"TokenChat",description:"Web3 Chat Application",url:"https://c4ctus96.github.io/tokenchat",icons:["https://avatars.githubusercontent.com/u/37784886"]},Ie=[E,L],F=ae({chains:Ie,transports:{[E.id]:M("https://eth-mainnet.g.alchemy.com/v2/demo"),[L.id]:M("https://arb-mainnet.g.alchemy.com/v2/demo")},connectors:[ce({projectId:S,metadata:b,showQrModal:!1}),re({shimDisconnect:!0}),ie({appName:b.name,appLogoUrl:b.icons[0]}),le({options:{projectId:S},socials:["google","x","github","discord","apple"],showWallets:!0,email:!0,walletFeatures:!1})]});de({wagmiConfig:F,projectId:S,defaultChain:E,themeMode:"dark",enableAnalytics:!0,enableOnramp:!1,themeVariables:{"--w3m-accent":"#50b458","--w3m-color-mix":"#210059","--w3m-color-mix-strength":30}});function Be({children:t}){const{isConnected:s}=g();return s?e.jsx(e.Fragment,{children:t}):e.jsx(se,{to:"/"})}function Ue(){const{isConnected:t}=g();return l.useEffect(()=>{console.log("App initialized, connection status:",t),typeof window.ethereum>"u"&&console.log("MetaMask not detected, but WalletConnect can still be used")},[t]),null}function Me(){return e.jsx(ue,{config:F,children:e.jsx(Z,{client:Ee,children:e.jsx(pe,{children:e.jsxs(ee,{basename:"/tokenchat",children:[e.jsx(Ue,{}),e.jsxs(te,{children:[e.jsx(y,{path:"/",element:e.jsx(Se,{})}),e.jsx(y,{path:"/chat",element:e.jsx(Be,{children:e.jsx(we,{})})}),e.jsx(y,{path:"/signup",element:e.jsx(Ne,{})})]})]})})})})}const Pe=document.getElementById("root"),Re=ne(Pe);Re.render(e.jsx(P.StrictMode,{children:e.jsx(Me,{})}));
//# sourceMappingURL=index-0Wbk97Bb.js.map
